---
title: "Outcomes by Batch"
author: 'KLPS COVID-19 Sample'
#date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    fig_width: 9
    fig_height: 5.5
    theme: paper
    toc: FALSE
#    includes: 
#      before_body: header.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(haven)
library(tidyverse)
library(dygraphs)
library(xts)
#library(plotly)
#library(htmltools)

endweek = 20
endweektext = "August 21"
## Update tickers, counter tables and JS for two weeks

feb_axis = -4
lockd_axis_feb = -3
lockd_axis = -3
lockd_axis_less = 0
start_axis = -4
start_axis_less = -1

c_green = "#006d2c"
c_pink = "#fc92a5"
c_purple = "#aea9d9"
c_orange = "#fc995b"

precovid <- zap_formats(read_dta("/Users/zhang/Documents/GitHub/covid/data/precovid_averages.dta"))
precovid_full <- precovid %>% filter(full_sample == 1)


require(haven)
covid_batch <- read_dta("/Users/zhang/Documents/GitHub/covid/data/outcomes_R_fullsample_batch.dta")
covid_batch_mf <- read_dta("/Users/zhang/Documents/GitHub/covid/data/outcomes_R_malefemale_batch.dta")
covid_batch_ur <- read_dta("/Users/zhang/Documents/GitHub/covid/data/outcomes_R_urbanrural_batch.dta")
covid_batch_tc <- read_dta("/Users/zhang/Documents/GitHub/covid/data/outcomes_R_treatcontrol_batch.dta")
covid_batch_oy <- read_dta("/Users/zhang/Documents/GitHub/covid/data/outcomes_R_oldyoung_batch.dta")

## Add batch median date 
## NA rows for week 2 and endweek (annotation)
batch_index <- data.frame(batch = c(NA,1:5, NA), twoweeks = c(start_axis, 3.429, 6.571, 9.571, 13.143, 16.714, endweek))
covid_batch <- rbind(rep(NA,69),covid_batch)
covid_batch <- merge(covid_batch, batch_index, by = "batch")
covid_batch <-covid_batch[order(covid_batch$twoweeks),]

batch_index <- data.frame(batch = c(NA,1:5, NA), twoweeks = c(start_axis, 3.429, 6.571, 9.571, 13.143, 16.714, endweek))

covid_batch_mf <- rbind(rep(NA,70),rep(NA,70),covid_batch_mf)
covid_batch_mf <- merge(covid_batch_mf, batch_index, by = "batch")
covid_batch_mf[covid_batch_mf$twoweeks==start_axis,"female"] <- c(1,0)
covid_batch_mf[covid_batch_mf$twoweeks==endweek,"female"] <- c(1,0)

covid_batch_ur <- rbind(rep(NA,70),covid_batch_ur)
covid_batch_ur <- merge(covid_batch_ur, batch_index, by = "batch")
covid_batch_ur[covid_batch_ur$twoweeks==start_axis,"urban"] <- c(1,0)
covid_batch_ur[covid_batch_ur$twoweeks==endweek,"urban"] <- c(1,0)

covid_batch_tc <- rbind(rep(NA,70),rep(NA,70),covid_batch_tc)
covid_batch_tc <- merge(covid_batch_tc, batch_index, by = "batch")
covid_batch_tc[covid_batch_tc$twoweeks==start_axis,"psdp_treat"] <- c(1,0)
covid_batch_tc[covid_batch_tc$twoweeks==endweek,"psdp_treat"] <- c(1,0)

covid_batch_oy <- rbind(rep(NA,70),covid_batch_oy)
covid_batch_oy <- merge(covid_batch_oy, batch_index, by = "batch")
covid_batch_oy[covid_batch_oy$twoweeks==start_axis,"older"] <- c(1,0)
covid_batch_oy[covid_batch_oy$twoweeks==endweek,"older"] <- c(1,0)

nospace <- function(df){
    df[df$twoweeks==-4, "twoweeks"] <- start_axis_less 
    df
  }

covid_batch_nospace <- nospace(covid_batch)
covid_batch_mf_nospace <- nospace(covid_batch_mf)
covid_batch_ur_nospace <- nospace(covid_batch_ur)
covid_batch_tc_nospace <- nospace(covid_batch_tc)
covid_batch_oy_nospace <- nospace(covid_batch_oy)


#grouping consumption vars 
c <- c("twoweeks", "c2_wins", "c3_wins","c4_wins") 
c <- covid_batch[c]

#grouping earnings (income) vars 
i <- c("twoweeks", "i4_wins", "i3_wins", "i2_wins" , "i1_wins")
i <- covid_batch[i]
i <- i[order(i$twoweeks),]
i <- rbind(c(feb_axis,covid_batch$i4_feb2020_wins[3],covid_batch$i3_feb2020_wins[3],NA,NA),i)
          
i_self <- c("twoweeks", "i4_self_wins", "i3_self_wins", "i2_self_wins")#, "i1_self_wins")
i_self <- covid_batch[i_self]
i_self <- rbind(c(feb_axis,NA,NA,covid_batch$i2_feb2020_wins[3],NA),i_self)
    
##transfers 
tf <- c("twoweeks", "i5_wins", "i6")
tf <- covid_batch[tf]
#tf <- tf[order(tf$twoweeks),]

#grouping labor vars 
l <- c("twoweeks", "l1_tc", "l2_tc", "l3_tc", "l4_tc")
l <- covid_batch[l]

lcc <- c("twoweeks", "l5_tc")
lcc <- covid_batch[lcc]

ue <- c("twoweeks", "l6", "l7")
ue <- covid_batch[ue]

#food security vars
f1_d <- c("twoweeks","f1_d_skippedadult", "f1_d_skippedchild", "f1_d_hungryadult", "f1_d_hungrychild", "f1_d_nofoodadult", "f1_d_nofoodchild")
f1_d <- covid_batch_nospace[f1_d]

f1_w <- covid_batch_nospace %>% 
  select(twoweeks, f1_worry)

f1_meals <- c("twoweeks", "f1_meat", "f1_eggs")
f1_meals <- covid_batch_nospace[f1_meals]

f1_idx <- c("twoweeks", "f1", "f3", "f4")
f1_idx <- covid_batch_nospace[f1_idx]


#covid vars 
prevalence <- c("twoweeks","cs1","cs2") # "cs4"  "cs3
prevalence <- covid_batch_nospace[prevalence]

ckn <- c("twoweeks", "ckn1", "ckn2", "ckn3", "ckn4")
ckn <- covid_batch_nospace[ckn]

cbc <- c("twoweeks", "cbc1", "cbc2", "cbc3")
cbc <- covid_batch_nospace[cbc]

cov1 <- c("twoweeks", "cov1_fever", "cov1_tired", "cov1_cough", "cov1_dbreath")
cov1 <- covid_batch_nospace[cov1]

s3 <-  covid_batch_nospace[c("twoweeks", "s3_4travel")]
#In the past 14 days, did  you travel to (and returned from) another town or city

# mental health vars
mh <- c("twoweeks", 'nervous' ,'lonely', 'hopeful', 'phyreaction','depressed')
mh <- covid_batch[mh]


# valueformatter for x axis
getMedianDate <- "function(d) {
                var dateNames = ['Feb','0', '1', '2', 'April 27 (Batch 1)',
                  '4', '5','6', 'May 19 (Batch 2)',
                     '8', '9', 'June 09 (Batch 3)',
                     '11','12','July 04 (Batch 4)',
                '14','15','16','July 29 (Batch 5)',
                '18','19','20'];
                var index = Math.round(d)+1;
                return dateNames[index]+'  '; }" 



tickers_batch_feb <- "function(min, max, pixels, opts, dygraph, vals) { 
return [
    { v: -4, label: 'Feb. (Recall)' },
    { v: 1.5, label: 'Batch ' },
    { v: 3.429, label: '1: April 27' }, 
    { v: 6.571, label: '2:May 19' }, 
    { v: 9.571, label: '3:June 09' }, 
    { v: 13.143, label: '4:July 04' }, 
    { v: 16.714, label: '5:July 29' }, 
    { v: 20, label: '' } 
       ]; } "#August 21

tickers_batch_side <- "function(min, max, pixels, opts, dygraph, vals) { 
return [
    { v: -4, label: 'Feb. (Recall)' },
    { v: 0.8, label: 'Batch ' },
    { v: 3.429, label: '1: April 27' }, 
    { v: 6.571, label: '2:May 19' }, 
    { v: 9.571, label: '3:June 09' }, 
    { v: 13.143, label: '4:July 04' }, 
    { v: 16.714, label: '5:July 29' }, 
    { v: 20, label: '' }
       ]; } "


tickers_batch <- "function(min, max, pixels, opts, dygraph, vals) { 
return [
    { v: 1, label: 'Batch ' },
    { v: 3.429, label: '1: April 27' }, 
    { v: 6.571, label: '2:May 19' }, 
    { v: 9.571, label: '3:June 09' }, 
    { v: 13.143, label: '4:July 04' }, 
    { v: 16.714, label: '5:July 29' }, 
    { v: 20, label: '' }
       ]; } "


# Batch median date annotation
 median_w <-c(3.429, 6.571, 9.571, 13.143, 16.714)
 median_d <-c("April 27","May 19","June 09","July 04","July 29")

# Data prep in groups global func
data_group <- function(dataset, varlist, factor){
     df_a <- subset(dataset,factor == 1,varlist)
   df_b <- subset(dataset,factor == 0,varlist)
   df_ab<- merge(df_a, df_b, by = "twoweeks", suffixes = c(".1",".0"))
}
```

  
```{css echo=FALSE}
.sideby {
 # display: inline-block;
 # position: relative;
	float: left;
	width: 50%;
	padding: 10px;
	box-sizing: border-box;
}


.dygraph-legend {
  #left: 70px !important;
  background-color: transparent !important;
}

.dygraph-legend-side {
  #left: 70px !important;
  font-size: 0.2em !important;
  background-color: transparent !important;
}

.dygraph-legend_left {
  left: 70px !important;
  background-color: transparent !important;
}

.few .dygraph-legend > span.highlight { border: 1px solid grey; font-weight: boldest; }


.dygraph-default-annotation {
    border: 1px solid green;
    background-color: white;
    text-align: center;
}

.batch-annotation{
    border: 1px solid rgb(208,208,208) !important;
    font-size: 0.8em !important;
    color: gray !important;
    background-color: transparent !important;
    text-align: center;
}
```


## {.tabset}

### Income

<font size="5">**Household Earnings per Capita (USD, PPP) - past 14 days**</font>

<!-- Treatment indivituals are those who received early treatment in Primary School Deworming Program (PSDP) during 1998-2001. Older and younger cohorts are specified within PSDP participants. -->

####  {.tabset .tabset-pills}

##### Full sample 
```{r income}
presOptions_income <- function(dygraph) {
  dygraph %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 30, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch_feb,  axisLabelFontSize = 12) %>%
    dyAxis("y", label = "USD, PPP (2017) ", drawGrid = FALSE, valueRange = c(0,85)) %>% 
    dyLegend(width = 300, labelsSeparateLines = TRUE) %>%
    dyCrosshair(direction = "vertical") %>%
 #   presAnnotation(below = TRUE) %>% 
    dyEvent(lockd_axis_feb , "Lockdown begins March 15", labelLoc = "top") %>%
    dyEvent(feb_axis , "Feburary", labelLoc = "top",strokePattern = "solid",color = "gray") %>% #, color = "gray"
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))
}

i_g <- dygraph(i, main = "") %>%
  dySeries("i4_wins", strokeWidth = 5, label = "Total Household Earnings per Capita", pointShape = "square") %>%
  dySeries("i3_wins", strokeWidth = 4, label = "Household Wage Earnings per Capita") %>%
  dySeries("i2_wins", strokeWidth = 4, label = "Household Self-Employment Profits per Capita") %>%
  dySeries("i1_wins", strokeWidth = 4, label = "Household Agricultural Profits per Capita") %>%
presOptions_income() %>% 
  dyOptions(stackedGraph = FALSE, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4, colors = c('#005a32',"#FC8D62", "#8DA0CB", "#E78AC3"), connectSeparatedPoints = FALSE, rightGap = 20) %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))%>% 
    dyLimit(limit = precovid_full$i4_hh_precovid, "                  Total Earnings (2017-2019 avg.)", strokePattern = "dotted", color = c_green) %>% 
    dyLimit(limit = precovid_full$i1_hh_precovid, "                  Agricultural Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_pink) %>% 
    dyLimit(limit = precovid_full$i2_hh_precovid, "                  Self-Employment Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_purple) %>% 
    dyLimit(limit = precovid_full$i3_hh_precovid, "                  Wage Earnings (2017-2019 avg.)", strokePattern = "dotted", color = c_orange)
i_g



```



##### Female/Male
```{r income_fm}
color_income <- c("#FC8D62", "#8DA0CB", "#E78AC3")

presOptions_incomeside <- function(dygraph) {
  dygraph %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 20, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch_side,  axisLabelFontSize = 10) %>%
    dyAxis("y", label = "USD, PPP (2017) ", drawGrid = FALSE, valueRange = c(0,55)) %>% 
    dyLegend(width = 350, labelsSeparateLines = TRUE) %>%
    dyCrosshair(direction = "vertical") %>%
 #   presAnnotation(below = TRUE) %>% 
    dyEvent(lockd_axis_feb , "Lockdown begins March 15", labelLoc = "top") %>%
    dyEvent(feb_axis , "February", labelLoc = "top", strokePattern = "solid", color = "gray") %>%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))
}

i_g_group <- function(dataset,factor, pre_factor, group_label, title_text){
  # Careful with the order and v_ab[col]
  income_var <- colnames(i)
  v_ab <- data_group(dataset, income_var, factor)
  
  i_feb2020.1 <- c(dataset[factor==1,]$i4_feb2020_wins[1], dataset[factor==1,]$i3_feb2020_wins[1],NA, NA) # Add feb (only i4,i3)
  i_feb2020.0 <- c(dataset[factor==0,]$i4_feb2020_wins[1], dataset[factor==0,]$i3_feb2020_wins[1],NA, NA)
#  v_ab <- rbind(c(-2,NA,NA,NA,NA,NA,NA,NA,NA),v_ab)
  v_ab <- rbind(c(feb_axis,i_feb2020.1[1],i_feb2020.1[2],i_feb2020.1[3],i_feb2020.1[4],
                     i_feb2020.0[1],i_feb2020.0[2],i_feb2020.0[3],i_feb2020.0[4]),v_ab) 
     v_ab.col <- colnames(v_ab)
     
     precovid_a <- precovid %>%  
       filter(pre_factor == 1)
    precovid_b <- precovid %>%  
       filter(pre_factor == 0)

    
  # graghing 
  v_g_ab <- dygraph(v_ab[c(1,2,6)],main = "")%>% 
    dySeries(v_ab.col[2], strokeWidth = 5, label = group_label[7], strokePattern = "dashed", strokeBorderWidth = 1) %>%
    dySeries(v_ab.col[6], strokeWidth = 5, label = group_label[8], strokeBorderWidth = 1) %>%
    presOptions_income() %>%
    dyOptions(stackedGraph = FALSE, colors = c("#005a32","#4f7c12"), fillGraph = FALSE, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 5, connectSeparatedPoints = FALSE, rightGap = 20, pointShape = 'square') %>% 
    dyLimit(limit = precovid_a$i4_hh_precovid,  paste0("                 ", title_text[2], ": Total Earnings (2017-2019 avg.)"), strokePattern = "dotted", color = c_green) %>% 
      dyLimit(limit = precovid_b$i4_hh_precovid,  paste0("                 ", title_text[3], ": Total Earnings (2017-2019 avg.)"), strokePattern = "solid", color = c_green)
  
    	#078800
  #41ab5d
  v_g_a <- dygraph(v_ab[c(1,3:5)], main = title_text[2]) %>% # grouping
    dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[1], strokePattern = "dashed") %>%
    dySeries(v_ab.col[4], strokeWidth = 4, label = group_label[2], strokePattern = "dashed") %>%
    dySeries(v_ab.col[5], strokeWidth = 4, label = group_label[3], strokePattern = "dashed") %>%
    presOptions_incomeside() %>%
    dyOptions(stackedGraph = FALSE, colors = color_income, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4, connectSeparatedPoints = FALSE, rightGap = 20) %>% 
            dyLimit(limit = precovid_a$i1_hh_precovid, "          Agricultural Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_pink) %>% 
    dyLimit(limit = precovid_a$i2_hh_precovid, "          Self-Employment Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_purple) %>% 
    dyLimit(limit = precovid_a$i3_hh_precovid, "          Wage Earnings (2017-2019 avg.)", strokePattern = "dotted", color = c_orange)

  i_g_b <- dygraph(v_ab[c(1,7:9)], main = title_text[3])  %>%
    dySeries(v_ab.col[7], strokeWidth = 4, label = group_label[4]) %>%
    dySeries(v_ab.col[8], strokeWidth = 4, label = group_label[5]) %>%
    dySeries(v_ab.col[9], strokeWidth = 4, label = group_label[6]) %>%
    presOptions_incomeside() %>%
    dyOptions(stackedGraph = FALSE, colors = color_income, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4, connectSeparatedPoints = FALSE, rightGap = 20) %>% 
  dyAxis("y", label = "", drawGrid = FALSE, valueRange = c(0,85)) %>% 
        dyLimit(limit = precovid_b$i1_hh_precovid, "          Agricultural Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_pink) %>% 
    dyLimit(limit = precovid_b$i2_hh_precovid, "          Self-Employment Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_purple) %>% 
    dyLimit(limit = precovid_b$i3_hh_precovid, "          Wage Earnings (2017-2019 avg.)", strokePattern = "dotted", color = c_orange)
  
  g <- list(v_g_ab, v_g_a, i_g_b)
}

i_glab_fm<- c("Female HH Wage Earnings per Capita", "Female HH Self-Employment Profits per Capita",
                 "Female HH Agricultural Profits per Capita",
                 "Male HH Wage Earnings per Capita", "Male HH Self-Employment Profits per Capita",
                 "Male HH Agricultural Profits per Capita","Female: Total Household Earnings per Capita", "Male: Total Household Earnings per Capita")

i_glab_ur<- c("Urban HH Wage Earnings per Capita", "Urban HH Self-Employment Profits per Capita", 
                 "Urban HH Agricultural Profits per Capita", 
                 "Rural HH Wage Earnings per Capita", "Rural:  Household Self-Employment Profits per Capita", 
                 "Rural HH Agricultural Profits per Capita", "Urban: Total Household Earnings", "Rural Total Household Earnings")

i_glab_tc<- c("Treatment HH Wage Earnings per Capita", "Treatment HH Self-Employment Profits per Capita", 
                 "Treatment HH Agricultural Profits per Capita", 
                 "Control HH Wage Earnings per Capita", "Control:  Household Self-Employment Profits per Capita", 
                 "Control HH Agricultural Profits per Capita" ,"Treatment Total Household Earnings", "Control Total Household Earnings")

i_glab_oy<- c("Older HH Wage Earnings per Capita", "Older HH Self-Employment Profits per Capita", 
                 "Older HH Agricultural Profits per Capita", 
                 "Younger HH Wage Earnings per Capita", "Younger:  Household Self-Employment Profits per Capita", 
                 "Younger HH Agricultural Profits per Capita" ,"Older: Total Household Earnings", "Younger: Total Household Earnings")

i_g_groupfm <- i_g_group(covid_batch_mf, covid_batch_mf$female, pre_factor=precovid$female, i_glab_fm, title_text = c("Female/Male","Female", "Male"))
i_g_groupfm[[1]]
```

###### {.sideby .dygraph-legend-side}
```{r fig.width=5, fig.height=4}
i_g_groupfm[[2]]
```

###### {.sideby .dygraph-legend-side}
```{r fig.width=5, fig.height=4}
i_g_groupfm[[3]]
```

##### Urban/Rural
```{r income_ur}
i_g_groupur <-i_g_group(covid_batch_ur, factor = covid_batch_ur$urban, pre_factor=precovid$urban,i_glab_ur, title_text = c("Urban/Rural", 'Urban', 'Rural'))
i_g_groupur[[1]]
```

###### {.sideby}
```{r fig.width=5, fig.height=4}
i_g_groupur[[2]]
```

###### {.sideby}
```{r fig.width=5, fig.height=4}
i_g_groupur[[3]]
```

<!-- ##### PSDP Treatment/Control -->
<!-- ```{r income_tc} -->
<!-- i_g_grouptc <-i_g_group(covid_batch_tc, factor = covid_batch_tc$psdp_treat, precovid$psdp_treat,i_glab_tc,  title_text = c("by PSDP Treatment", 'Treatment', 'Control')) -->
<!-- i_g_grouptc[[1]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- i_g_grouptc[[2]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- i_g_grouptc[[3]] -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r income_oy} -->
<!-- i_g_groupoy <-i_g_group(covid_batch_oy, factor = covid_batch_oy$older, precovid$older, i_glab_oy, title_text = c("by PSDP Age", 'PSDP Older', 'PSDP Younger')) -->
<!-- i_g_groupoy[[1]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- i_g_groupoy[[2]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- i_g_groupoy[[3]] -->
<!-- ``` -->

####
 
This plot shows household earnings per capita, which is equal to the sum of wage employment earnings, self-employment profits, and agricultural profits in the past 14 days across the household, divided by the number of household members. It also plots the three earning sources separately. All monetary values are converted to 2017 USD at Purchasing Power Parity (PPP) for comparability with other KLPS data. Results are winsorized at the top 1% level.

We also ask respondents to recall their households' total earnings and total wage employment earnings for a typical week in Feb 2020.
  
***  

<font size="5">**Individual Earnings (USD, PPP) - past 14 days**</font>

<!-- Treatment indivituals are those who received early treatment in Primary School Deworming Program (PSDP) during 1998-2001. Older and younger cohorts are specified within PSDP participants. -->

####  {.tabset .tabset-pills}

##### Full sample 

```{r income_self}
## dygraph presOptions func
presOptions_incomeind <- function(dygraph) {
  dygraph %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 20, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch_feb, axisLabelFontSize = 12) %>% 
   dyAxis("y", label = "USD, PPP (2017) ", drawGrid = FALSE, valueRange = c(0,125)) %>% 
   dyLegend(width = 300, labelsSeparateLines = TRUE) %>%
   dyCrosshair(direction = "vertical") %>%
   dyEvent(lockd_axis_feb , "Lockdown begins March 15", labelLoc = "top") %>%
   dyEvent(feb_axis , "February", labelLoc = "top", strokePattern = "solid", color = "gray") %>%
   dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))
}

ii_g <- dygraph(i_self, main = "") %>%
  dySeries("i4_self_wins", strokeWidth = 5, label = "Total Individual Earnings",pointSize = 4 ,pointShape = 'square') %>%
  dySeries("i3_self_wins", strokeWidth = 4, label = "Individual Wage Earnings") %>%
  dySeries("i2_self_wins", strokeWidth = 4, label = "Individual Self-Employment Profits") %>%
# dySeries("i1_self_wins", strokeWidth = 4, label = "Agricultural Profits") %>%
presOptions_incomeind() %>% 
  dyOptions(stackedGraph = FALSE, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4, colors = c('#005a32',"#FC8D62", "#8DA0CB", "#E78AC3"), connectSeparatedPoints = FALSE, rightGap = 20) %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>% 
    dyLimit(limit = precovid_full$i4_self_precovid, "                Total Earnings (2017-2019 avg.)", strokePattern = "dotted", color = "green") %>% #Individual total earnings
#    dyLimit(limit = precovid_full$i1_self_precovid, "                Agricultural Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_pink) %>% 
    dyLimit(limit = precovid_full$i2_self_precovid, "                Self-Employment Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_purple) %>% 
    dyLimit(limit = precovid_full$i3_self_precovid, "                Wage Earnings (2017-2019 avg.)", strokePattern = "dotted", color = c_orange)
ii_g
```



##### Female/Male
```{r income_self_fm}
color_income <- c("#FC8D62", "#8DA0CB", "#E78AC3")
#color_total_group <- c("#00441b","#005a32","#FC8D62", "#FC8D62", "#8DA0CB","#8DA0CB")

presOptions_incomeind_side <- function(dygraph, precovid_w) {
  dygraph %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 20, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch_side,  axisLabelFontSize = 10) %>%
    dyAxis("y", label = "USD, PPP (2017) ", drawGrid = FALSE, valueRange = c(0,100)) %>% 
    dyLegend(width = 300, labelsSeparateLines = TRUE) %>%
    dyCrosshair(direction = "vertical") %>%
    dyEvent(lockd_axis_feb , "Lockdown begins March 15", labelLoc = "top") %>%
    dyEvent(feb_axis , "February", labelLoc = "top", strokePattern = "solid", color = "gray") %>%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>% 
#   dyLimit(limit = precovid_w$i1_self_precovid,  "              Agricultural Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_pink) %>%
    dyLimit(limit = precovid_w$i2_self_precovid, "              Self-Employment Profits (2017-2019 avg.)", strokePattern = "dotted", color = c_purple) %>%
    dyLimit(limit = precovid_w$i3_self_precovid, "              Wage Earnings (2017-2019 avg.)", strokePattern = "dotted", color = c_orange)
}



ii_g_group <- function(dataset,factor, pre_factor, group_label, title_text){
  income_var <- colnames(i_self)#  "i1_self_wins") 1,2,6 / 1,3:5 / 1, 7:9
  i_feb2020.1 <- c(NA, NA, dataset[factor==1,]$i2_feb2020_wins[1], NA) # Add feb (only i4,i3)
  i_feb2020.0 <- c(NA, NA, dataset[factor==0,]$i2_feb2020_wins[1], NA)
  v_ab <- data_group(dataset, income_var, factor)
#  v_ab <- rbind(c(-2,NA,NA,NA,NA,NA,NA,NA,NA),v_ab)
  v_ab <- rbind(c(feb_axis,i_feb2020.1[1],i_feb2020.1[2],i_feb2020.1[3],i_feb2020.1[4],
                     i_feb2020.0[1],i_feb2020.0[2],i_feb2020.0[3],i_feb2020.0[4]),v_ab) 
  v_ab.col <- colnames(v_ab)
  
     precovid_a <- precovid %>%  
       filter(pre_factor == 1)
    precovid_b <- precovid %>%  
       filter(pre_factor == 0)

  
  ###### for seperated group graphs like HH earnings
   v_g_ab <- dygraph(v_ab[c(1,2,5)],main = "") %>%
 dySeries(v_ab.col[2], strokeWidth = 5, pointSize = 5, label = group_label[7], strokePattern = "dashed", strokeBorderWidth = 1, pointShape = 'square') %>%
    dySeries(v_ab.col[5], strokeWidth = 5, pointSize = 5, label = group_label[8], strokeBorderWidth = 1, pointShape = 'square') %>%
     presOptions_incomeind() %>%
        dyAxis("y", label = "USD, PPP (2017) ", drawGrid = FALSE, valueRange = c(0,135)) %>% 
      dyOptions(stackedGraph = FALSE, colors = c("#005a32","#4f7c12"), fillGraph = FALSE, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 5, connectSeparatedPoints = FALSE, rightGap = 20, pointShape = 'square') %>% 
    dyLimit(limit = precovid_a$i4_self_precovid, paste0("                 ", title_text[2], ": Total Earnings (2017-2019 avg.)"), strokePattern = "dashed", color = "green") %>% 
       dyLimit(limit = precovid_b$i4_self_precovid, paste0("                 ", title_text[3], ": Total Earnings (2017-2019 avg.)"), strokePattern = "solid", color = "green") #prefactor == 0
  
   v_g_a <- dygraph(v_ab[c(1,3:4)], main = title_text[2]) %>% # grouping
     dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[1], strokePattern = "dashed") %>%
    dySeries(v_ab.col[4], strokeWidth = 4, label = group_label[2], strokePattern = "dashed") %>%
     presOptions_incomeind_side(precovid_a) %>%
    dyOptions(stackedGraph = FALSE, colors = color_income, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4, connectSeparatedPoints = FALSE, rightGap = 20)

   v_g_b <- dygraph(v_ab[c(1,6:7)], main = title_text[3])  %>%
    dySeries(v_ab.col[6], strokeWidth = 4, label = group_label[4]) %>%
    dySeries(v_ab.col[7], strokeWidth = 4, label = group_label[5]) %>%
    presOptions_incomeind_side(precovid_b) %>%
    dyOptions(stackedGraph = FALSE, colors = color_income, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4, connectSeparatedPoints = FALSE, rightGap = 20)

  g <- list(v_g_ab, v_g_a, v_g_b)
}

# Labels prep
i_glab_fm<- c("Female: Wage Earnings", "Female: Self-Employment Profits", 
                 "Female: Agricultural Profits", 
                 "Male: Wage Earnings", "Male:  Self-Employment Profits", 
                 "Male: Agricultural Profits","Female: Total Individual Earnings", "Male: Total Individual Earnings")

i_glab_ur<- c("Urban: Wage Earnings", "Urban: Self-Employment Profits", 
                 "Urban: Agricultural Profits", 
                 "Rural: Wage Earnings", "Rural:  Self-Employment Profits", 
                 "Rural: Agricultural Profits", "Urban Total Individual Earnings", "Rural Total Individual Earnings")

i_glab_tc<- c("Treatment: Wage Earnings", "Treatment: Self-Employment Profits", 
                 "Treatment: Agricultural Profits", 
                 "Control: Wage Earnings", "Control:  Self-Employment Profits", 
                 "Control: Agricultural Profits" ,"Treatment Total Individual Earnings", "Control Total Individual Earnings")

i_glab_oy<- c("Older: Wage Earnings", "Older: Self-Employment Profits", 
                 "Older: Agricultural Profits", 
                 "Younger: Wage Earnings", "Younger:  Self-Employment Profits", 
                 "Younger: Agricultural Profits" ,"Older: Total Individual Earnings", "Younger: Total Individual Earnings")


ii_g_groupfm <- ii_g_group(covid_batch_mf, covid_batch_mf$female, precovid$female, i_glab_fm, title_text = c("Female/Male","Female", "Male"))
ii_g_groupfm[[1]]
```


###### {.sideby}
```{r fig.width=5, fig.height=4}
ii_g_groupfm[[2]]
```

###### {.sideby}
```{r fig.width=5, fig.height=4}
ii_g_groupfm[[3]]
```


##### Urban/Rural
```{r income_self_ur}
ii_g_groupur <-ii_g_group(covid_batch_ur, i_glab_ur, factor = covid_batch_ur$urban, pre_factor =  precovid$urban, title_text = c("Urban/Rural", 'Urban', 'Rural'))
ii_g_groupur[[1]]
```

###### {.sideby}
```{r fig.width=5, fig.height=4}
ii_g_groupur[[2]]
```

###### {.sideby}
```{r fig.width=5, fig.height=4}
ii_g_groupur[[3]]
```

<!-- ##### PSDP Treatment/Control -->
<!-- ```{r income_self_tc} -->
<!-- ii_g_grouptc <-ii_g_group(covid_batch_tc, i_glab_tc, factor = covid_batch_tc$psdp_treat, pre_factor = precovid$psdp_treat, title_text = c("by PSDP Treatment", 'Treatment', 'Control')) -->
<!-- ii_g_grouptc[[1]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- ii_g_grouptc[[2]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- ii_g_grouptc[[3]] -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r income_self_oy} -->
<!-- ii_g_groupoy <-ii_g_group(covid_batch_oy, i_glab_oy, factor = covid_batch_oy$older, pre_factor = precovid$older, title_text = c("by PSDP Age", 'PSDP Older', 'PSDP Younger')) -->
<!-- ii_g_groupoy[[1]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- ii_g_groupoy[[2]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- ii_g_groupoy[[3]] -->
<!-- ``` -->



####
This plot shows the total individual earnings outside of agriculture, which is equal to the sum of wage employment earnings and self-employment profits in the past 14 days. It also plots self-employment earnings and wages separately. All monetary values are converted to 2017 USD at Purchasing Power Parity (PPP) for comparability with other KLPS data. Results are winsorized at the top 1% level.


We also ask respondents to recall their self-employment profits for a typical week in Feb 2020. 
   
***   

  <font size="5">**Transfers per Capita (USD, PPP) - past 14 days**</font>  
  
####  {.tabset .tabset-pills}

##### Full sample
```{r transfers, echo=FALSE}
presOptions_tf <- function(dygraph){
  dygraph %>% 
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE , label = "USD, PPP (2017)", valueRange = c(-15,8)) %>% 
    dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
  dyLegend(width = 500, labelsSeparateLines = TRUE) %>% 
    dyEvent(lockd_axis , "Lockdown begins March 15", labelLoc = "top") 
}

tf_g  <- dygraph(tf, main = "") %>%
  dySeries("i5_wins", strokeWidth = 4, label = "Support from Government/NGOs etc") %>%
  dySeries("i6", strokeWidth = 4, label = "Net Inter Household Transfers") %>%
  presOptions_tf() %>% 
  dyOptions(colors = RColorBrewer::brewer.pal(3, "Dark2"),axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE,drawPoints = TRUE, pointSize = 4)
tf_g
```

##### Female/Male
```{r tf_fm}
tf_g_group <- function(dataset, factor, group_label, title_text){
  # Variable prep, careful with the order and v_ab[]
  v_ab <- data_group(dataset, colnames(tf), factor) #colnames(tf) = c("twoweeks" "i5_wins"  "i6")
    v_ab.col <- colnames(v_ab)

  g <- dygraph(v_ab) %>% # group
    dySeries(v_ab.col[2], strokeWidth = 4, label = group_label[1], strokePattern = "dashed") %>%
    dySeries(v_ab.col[4], strokeWidth = 4, label = group_label[3]) %>%
    dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[2], strokePattern = "dashed") %>%
    dySeries(v_ab.col[5], strokeWidth = 4, label = group_label[4]) %>%
    presOptions_tf() %>%
    dyOptions(colors = c( "#1B9E77" , "#1B9E77", "#D95F02","#D95F02"),axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE,drawPoints = TRUE, pointSize = 4)
}

tf_glab_fm <- c("Female: Support from Support from Government/NGOs etc)", "Female: Net Inter Household Transfers","Male: Support from Government/NGOs etc)", "Male: Net Inter Household Transfers")

##???
tf_glab_ur <- c("Urban: Support from Government/NGOs etc)", "Urban: Net Inter Household Transfers","Rural: Support from Government/NGOs etc)", "Rural: Net Inter Household Transfers")

tf_glab_tc <- c("Treatment: Support from Government/NGOs etc)", "Treatment: Net Inter Household Transfers","Control: Support from Government/NGOs etc)", "Control: Net Inter Household Transfers")

tf_glab_oy <- c("Older: Support from Government/NGOs etc)", "Older: Net Inter Household Transfers","Younger: Support from Government/NGOs etc)", "Younger: Net Inter Household Transfers")


tf_g_groupfm <- tf_g_group(covid_batch_mf, covid_batch_mf$female, tf_glab_fm, title_text = "by gender")

tf_g_groupur <- tf_g_group(covid_batch_ur, factor = covid_batch_ur$urban, tf_glab_ur, "by Urban/Rural")

tf_g_grouptc <- tf_g_group(covid_batch_tc, factor = covid_batch_tc$psdp_treat, tf_glab_tc, "by PSDP Treatment")

tf_g_groupoy <- tf_g_group(covid_batch_oy, factor = covid_batch_oy$older, tf_glab_oy, "by PSDP Age")

tf_g_groupfm
```

##### Urban/Rural  
```{r tf_ur}
tf_g_groupur
```


<!-- ##### PSDP Treatment/Control   {.dygraph-legend_left}  -->
<!-- ```{r tf_tc} -->
<!-- tf_g_grouptc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r tf_oy} -->
<!-- tf_g_groupoy -->
<!-- ``` -->

####

The plot shows the household transfers per capita, which includes support from government, NGOs/community groups and politicians in the past 14 days and net inter household transfers received in the past 14 days, divided by the number of household members. All monetary values are converted to 2017 USD at Purchasing Power Parity (PPP) for comparability with other KLPS data. Results are winsorized at the top 1% level.

*** 


### Consumption

<font size="5">**Household Consumption per Capita (USD, PPP) - past 7 days**</font>

<!-- Treatment indivituals are those who received early treatment in Primary School Deworming Program (PSDP) during 1998-2001. Older and younger cohorts are specified within PSDP participants. -->


####  {.tabset .tabset-pills}

##### Full sample
``` {r consumption, fig_width = 10, fig_height = 5}
# func with stacked
presOptions_cons<- function(dygraph) {
  dygraph %>%
  dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", label = "USD, PPP (2017)", drawGrid = FALSE, valueRange = c(0,40)) %>% #valueRange
  dyLegend(width = 300, labelsSeparateLines = TRUE) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>% 
  dyEvent(-3 , "Lockdown begins March 15", labelLoc = "top") 
#  dyLimit(limit = covid_batch$c4_precovid[3], "            Total Consumption (2017-2019 avg.)", strokePattern = "dotted", color = "green") 
        
}
# full sample graph
c_g <- dygraph(c, main = "") %>% 
    dySeries("c4_wins", strokeWidth = 5, pointSize = 4, label = "Total Household Consumption per Capita", pointShape = 'square') %>% 
    dySeries("c2_wins", strokeWidth = 4, label = "Food Consumption per Capita") %>%
    dySeries("c3_wins", strokeWidth = 4, label = "Non-food Expenditure per Capita") %>%
    dyOptions(stackedGraph = FALSE, includeZero = TRUE, connectSeparatedPoints = FALSE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4, colors = c('#00441b',"#FC8D62", "#8DA0CB", "#E78AC3")) %>%
    presOptions_cons() 
c_g
```


##### Female/Male {class="row"}

```{r consumption_fm}
color_total_group <- c("#00441b",c_green,"#FC8D62", "#FC8D62", "#8DA0CB","#8DA0CB") #green dark "#005a32"


presOptions_cons_side<- function(dygraph) {
  dygraph %>%
  dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch_side, axisLabelFontSize = 12) %>% 
  dyAxis("y", label = "USD, PPP (2017)", drawGrid = FALSE, valueRange = c(0,35)) %>% #valueRange
  dyLegend(width = 250, labelsSeparateLines = TRUE) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>% 
  dyEvent(-3 , "Lockdown begins March 15", labelLoc = "top") 
}

c_g_group <- function(dataset, factor, group_label, title_text){
  consumption_var <- colnames(c) #"twoweeks" "c2_wins"  "c3_wins"  "c4_wins" 
  v_ab <- data_group(dataset, consumption_var, factor)
  v_ab.col <- colnames(v_ab)

# c_g_ab <- dygraph(v_ab, main = "")%>% 
#     dySeries(v_ab.col[4], strokeWidth = 5, pointSize = 4, label = group_label[7], strokePattern = "dashed", pointShape = "square") %>%
#         dySeries(v_ab.col[7], strokeWidth = 5, pointSize = 4, label = group_label[8], strokeBorderWidth = 1, pointShape = "square") %>%
#     dySeries(v_ab.col[2], strokeWidth = 4, label = group_label[2], strokePattern = "dashed",pointShape = "dot") %>%
#     dySeries(v_ab.col[5], strokeWidth = 4, label = group_label[5],pointShape = "dot") %>%
#       dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[1], strokePattern = "dashed",pointShape = "dot") %>%
#       dySeries(v_ab.col[6], strokeWidth = 4, label = group_label[4],pointShape = "dot") %>%
#     presOptions_cons() %>% 
#    dyLegend(width = 380, labelsSeparateLines = TRUE) %>%
#     dyOptions(stackedGraph = FALSE, colors = color_total_group, fillGraph = FALSE, strokeBorderWidth = 1, includeZero = TRUE, connectSeparatedPoints = FALSE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4)
# }

  v_g_ab <- dygraph(v_ab[c(1,4,7)],main = "")%>% 
      dySeries(v_ab.col[4], strokeWidth = 5, pointSize = 4, label = group_label[7], strokePattern = "dashed", pointShape = "square") %>%
      dySeries(v_ab.col[7], strokeWidth = 5, pointSize = 4, label = group_label[8], strokeBorderWidth = 1, pointShape = "square") %>%  
      presOptions_cons() %>% 
      dyLegend(width = 380, labelsSeparateLines = TRUE) %>%
      dyOptions(stackedGraph = FALSE, colors =  c("#005a32","#4f7c12"), fillGraph = FALSE, strokeBorderWidth = 1, includeZero = TRUE, connectSeparatedPoints = FALSE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4)
    
  v_g_a <- dygraph(v_ab[c(1,2:3)], main = title_text[1]) %>% # grouping
    dySeries(v_ab.col[2], strokeWidth = 4, label = group_label[2], strokePattern = "dashed",pointShape = "dot") %>%
    dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[1], strokePattern = "dashed",pointShape = "dot") %>%
    presOptions_cons_side() %>% 
     dyLegend(width = 380, labelsSeparateLines = TRUE) %>%
    dyOptions(stackedGraph = FALSE, colors =  color_income, fillGraph = FALSE, strokeBorderWidth = 1, includeZero = TRUE, connectSeparatedPoints = FALSE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4)
   
  v_g_b <- dygraph(v_ab[c(1,5:6)], main = title_text[2])  %>%
    dySeries(v_ab.col[5], strokeWidth = 4, label = group_label[5], strokePattern = "dashed",pointShape = "dot") %>%
    dySeries(v_ab.col[6], strokeWidth = 4, label = group_label[4], strokePattern = "dashed",pointShape = "dot") %>%
    presOptions_cons_side() %>% 
    dyLegend(width = 380, labelsSeparateLines = TRUE) %>%
    dyOptions(stackedGraph = FALSE, colors =  color_income, fillGraph = FALSE, strokeBorderWidth = 1, includeZero = TRUE, connectSeparatedPoints = FALSE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4)
   
g <- list(v_g_ab, v_g_a, v_g_b)
}

c_glab_fm <- c("Female: Non-food Expenditure per Capita", "Female: Food Consumption per Capita", 
                 "!Female: Food expenditure!", 
                 "Male: Non-food Expenditure per Capita", "Male: Food Consumption per Capita", 
                 "!Male: Food expenditure!",
               "Female: Total Household Consumption per Capita","Male: Total Household Consumption per Capita") # total

c_glab_ur <- c("Urban: Non-food Expenditure per Capita", "Urban: Food Consumption per Capita", 
                 "!Urban: Food expenditure!", 
                 "Rural: Non-food Expenditure per Capita", "Rural: Food Consumption per Capita", 
                 "!Rural: Food expenditure!","Urban: Total Household Consumption per Capita","Rural: Total Household Consumption per Capita")
c_glab_tc <- c("Treatment: Non-food Expenditure per Capita", "Treatment: Food Consumption per Capita", 
                 "!Treatment: Food expenditure!", 
                 "Control: Non-food Expenditure per Capita", "Control: Food Consumption per Capita", 
                 "!Control: Food expenditure!","Treatment: Total Household Consumption per Capita","Control: Total Household Consumption per Capita")

i_glab_oy<- c("Older: Non-food Expenditure per Capita", "Older: Food Consumption per Capita", 
                 "!Older: Food expenditure!", 
                 "Younger: Non-food Expenditure per Capita", "Younger: Food Consumption per Capita", 
                 "!Younger: Food expenditure!","Older: Total Household Consumption per Capita","Younger: Total Household Consumption per Capita")

c_g_groupfm <- c_g_group(covid_batch_mf, factor = covid_batch_mf$female, c_glab_fm, title_text = c("Female", "Male"))
c_g_groupfm[[1]]
```


###### {.sideby .dygraph-legend-side}
```{r fig.width=5, fig.height=4}
c_g_groupfm[[2]]
```

###### {.sideby .dygraph-legend-side}
```{r fig.width=5, fig.height=4}
c_g_groupfm[[3]]
```

 
 
##### Urban/Rural {class="row"}
```{r consumption_ur}

c_g_groupur <- c_g_group(covid_batch_ur, c_glab_ur, factor = covid_batch_ur$urban, title_text = c('Urban', 'Rural'))
c_g_groupur[[1]]
```
 
###### {.sideby .dygraph-legend-side}
```{r fig.width=5, fig.height=4}
c_g_groupur[[2]]
```

###### {.sideby .dygraph-legend-side}
```{r fig.width=5, fig.height=4}
c_g_groupur[[3]]
```



<!-- ##### PSDP Treatment/Control {class="row"} -->
<!-- ```{r consumption_tc} -->
<!-- c_g_grouptc <- c_g_group(covid_batch_tc, c_glab_tc, factor = covid_batch_tc$psdp_treat, title_text = c('Treatment', 'Control')) -->
<!-- c_g_grouptc[[1]] -->
<!-- ``` -->

<!-- ###### {.sideby .dygraph-legend-side} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- c_g_grouptc[[2]] -->
<!-- ``` -->

<!-- ###### {.sideby .dygraph-legend-side} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- c_g_grouptc[[3]] -->
<!-- ``` -->



<!-- ##### PSDP Older/Younger {class="row"} -->
<!-- ```{r consumption_oy} -->

<!-- c_g_groupoy <-c_g_group(covid_batch_oy, i_glab_oy, factor = covid_batch_oy$older, title_text = c('PSDP Older', 'PSDP Younger')) -->
<!-- c_g_groupoy[[1]] -->
<!-- ``` -->

<!-- ###### {.sideby .dygraph-legend-side} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- c_g_groupoy[[2]] -->
<!-- ``` -->

<!-- ###### {.sideby .dygraph-legend-side} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- c_g_groupoy[[3]] -->
<!-- ``` -->

#### 

This plot shows the household consumption per capita, which is the sum of household food consumption and non-food expenditure in the last 7 days, divided by the number of household members. Household food consumption per capita is the monetary value of food items consumed by the household through purchase, gift, or home production in the last 7 days divided by the number of household members. Household non-food expenditure per capita is the monetary value of non-food items purchased in the last 7 days divided by the number of household members. All monetary values are converted to 2017 USD at Purchasing Power Parity (PPP) for comparability with other KLPS data. Results are winsorized at the top 1% level.


***

### Labor Supply

<font size="5">**Total Hours Worked - past 7 days**</font>

<!-- Treatment indivituals are those who received early treatment in Primary School Deworming Program (PSDP) during 1998-2001. -->

####  {.tabset .tabset-pills}

##### Full sample

``` {r labor}

presOptions_ls<- function(dygraph) {
  dygraph %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
    dyAxis("y", label = "Average Hours", drawGrid = FALSE, valueRange = c(0, 55)) %>% # 
    dyLegend(width = 300 , labelsSeparateLines = TRUE) %>%
    dyCrosshair(direction = "vertical") %>%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>% 
    dyEvent(lockd_axis , "Lockdown begins March 15", labelLoc = "top")
}

l_g <- dygraph(l, main = "") %>%
    dySeries("l4_tc", strokeWidth = 5, label = "Total Hours Worked", pointShape = 'square') %>%
    dySeries("l3_tc", strokeWidth = 4, label = "Wage Hours Worked") %>%
    dySeries("l2_tc", strokeWidth = 4, label = "Self-Employment Hours Worked") %>%
    dySeries("l1_tc", strokeWidth = 4, label = "Agricultural Hours Worked") %>%
      dyOptions(colors = c("#005a32", "#FC8D62", "#8DA0CB" ,"#E78AC3"), stackedGraph = FALSE, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4,  connectSeparatedPoints = TRUE) %>% 
    presOptions_ls() %>% 
    dyLimit(limit = precovid_full$l4_totalhrs_precovid, "                Total Hours (2017-2019 avg.)", strokePattern = "dotted", color = "green") %>% 
    dyLimit(limit = precovid_full$l3_wagehrs_precovid,  "                Wage Hours (2017-2019 avg.)", strokePattern = "dotted", color = c_pink) %>% 
    dyLimit(limit = precovid_full$l2_selfhrs_precovid,  "                Self-Employment Hours (2017-2019 avg.)", strokePattern = "dotted", color = c_purple) %>%  
     dyLimit(limit = precovid_full$l1_aghhrs_precovid,   "                Agricultural Hours (2017-2019 avg.)", strokePattern = "dotted", color = c_orange)

l_g
```


```{r labor_group}
l_g_group <- function(dataset,factor, pre_factor,group_label, title_text){
  # Variable prep, careful with the order and v_ab[]
  ls_var <- colnames(l) #c("twoweeks", "l1_tc", "l2_tc", "l3_tc", "l4_tc") 
  v_ab <- data_group(dataset, ls_var, factor)
    v_ab.col <- colnames(v_ab)
  
         precovid_a <- precovid %>%  
       filter(pre_factor == 1)
    precovid_b <- precovid %>%  
       filter(pre_factor == 0)
    
  #graghing 
  l_g_ab <- dygraph(v_ab[c(1,5,9)],main = "")%>%
    dySeries(v_ab.col[5], strokeWidth = 4, label = group_label[7], strokePattern = "dashed", strokeBorderWidth = 1) %>%
    dySeries(v_ab.col[9], strokeWidth = 4, label = group_label[8], strokeBorderWidth = 1) %>%
    presOptions_ls() %>%
    dyOptions(stackedGraph = FALSE, colors = c("#005a32","#4f7c12"), fillGraph = FALSE, includeZero = TRUE, axisLineWidth = 4, pointShape = "square", drawPoints = TRUE, pointSize = 4, connectSeparatedPoints = TRUE)%>% 
      dyLimit(limit = precovid_a$i4_self_precovid, paste0("                 ", title_text[2], ": Total Hours Worked (2017-2019 avg.)"), strokePattern = "dashed", color = "green") %>% 
       dyLimit(limit = precovid_b$i4_self_precovid, paste0("                 ", title_text[3], ": Total Hours Worked (2017-2019 avg.)"), strokePattern = "solid", color = "green") #prefactor == 0
  
  
  l_g_a <- dygraph(v_ab[1:4], main = title_text[2]) %>% # grouping
    dySeries(v_ab.col[2], strokeWidth = 4, label = group_label[1], strokePattern = "dashed") %>%
    dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[2], strokePattern = "dashed") %>%
    dySeries(v_ab.col[4], strokeWidth = 4, label = group_label[3], strokePattern = "dashed") %>%
    presOptions_ls() %>%
    dyOptions(stackedGraph = FALSE, colors = RColorBrewer::brewer.pal(3, "Set2"), includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4,  connectSeparatedPoints = TRUE) %>% 
    dyLimit(limit = precovid_a$l3_wagehrs_precovid, "               Wage Hours Worked (2017-2019 avg.)", strokePattern = "dotted", color = c_pink) %>% 
    dyLimit(limit = precovid_a$l2_selfhrs_precovid, "               Self-Employment Hours Worked (2017-2019 avg.)", strokePattern = "dotted", color = c_purple) %>%  
     dyLimit(limit = precovid_a$l1_aghrs_precovid, "                Agricultural Hours Worked (2017-2019 avg.)", strokePattern = "dotted", color = c_orange)

  l_g_b <- dygraph(v_ab[c(1,6:8)], main = title_text[3])  %>%
    dySeries(v_ab.col[6], strokeWidth = 4, label = group_label[4]) %>%
    dySeries(v_ab.col[7], strokeWidth = 4, label = group_label[5]) %>%
    dySeries(v_ab.col[8], strokeWidth = 4, label = group_label[6]) %>%
    presOptions_ls() %>%
    dyOptions(stackedGraph = FALSE, colors = RColorBrewer::brewer.pal(3, "Set2"), includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4,  connectSeparatedPoints = TRUE) %>% 
    dyLimit(limit = precovid_b$l3_wagehrs_precovid, "               Wage Hours Worked (2017-2019 avg.)", strokePattern = "dotted", color = c_pink) %>% 
    dyLimit(limit = precovid_b$l2_selfhrs_precovid, "               Self-Employment Hours Worked (2017-2019 avg.)", strokePattern = "dotted", color = c_purple) %>%  
     dyLimit(limit = precovid_b$l1_aghrs_precovid, "                Agricultural Hours Worked (2017-2019 avg.)", strokePattern = "dotted", color = c_orange)

  g <- list(l_g_ab, l_g_a, l_g_b)
}

# Labels prep
l_glab_fm<- c("Female: Agricultural Hours Worked", "Female: Self-Employment Hours Worked", 
                 "Female: Wage Hours Worked", 
                 "Male: Agricultural Hours Worked", "Male:  Self-Employment Hours Worked", 
                 "Male: Wage Hours Worked","Female: Total Hours Worked", "Male: Total Hours Worked")
l_g_groupfm <- l_g_group(covid_batch_mf, covid_batch_mf$female, pre_factor = precovid$female, l_glab_fm, title_text = c("Female/Male","Female", "Male"))


l_glab_ur<- c("Urban: Agricultural Hours Worked", "Urban: Self-Employment Hours Worked", 
                 "Urban: Wage Hours Worked", 
                 "Rural: Agricultural Hours Worked", "Rural:  Self-Employment Hours Worked", 
                 "Rural: Wage Hours Worked", "Urban: Total Hours Worked", "Rural: Total Hours Worked")
l_g_groupur <-l_g_group(covid_batch_ur, l_glab_ur, factor = covid_batch_ur$urban, pre_factor = precovid$urban, title_text = c("Urban/Rural", 'Urban', 'Rural'))


l_glab_tc<- c("Treatment: Agricultural Hours Worked", "Treatment: Self-Employment Hours Worked", 
                 "Treatment: Wage Hours Worked", 
                 "Control: Agricultural Hours Worked", "Control:  Self-Employment Hours Worked", 
                 "Control: Wage Hours Worked" ,"Treatment: Total Hours Worked", "Control: Total Hours Worked")

l_g_grouptc <-l_g_group(covid_batch_tc, l_glab_tc, factor = covid_batch_tc$psdp_treat, pre_factor = precovid$psdp_treat, title_text = c("by PSDP Treatment", 'Treatment', 'Control'))

l_glab_oy<- c("Older: Agricultural Hours Worked", "Older: Self-Employment Hours Worked", 
                 "Older: Wage Hours Worked", 
                 "Younger: Agricultural Hours Worked", "Younger:  Self-Employment Hours Worked", 
                 "Younger: Wage Hours Worked" ,"Older: Total Hours Worked", "Younger: Total Hours Worked")

l_g_groupoy <-l_g_group(covid_batch_oy, l_glab_tc,  factor = covid_batch_oy$older, pre_factor = precovid$older, title_text = c("by PSDP Age", 'Older', 'Younger'))

```

##### Female/Male
```{r labor_fm}
l_g_groupfm[[1]]
```

###### {.sideby}
```{r fig.width=5, fig.height=4}
l_g_groupfm[[2]]
```

###### {.sideby}
```{r fig.width=5, fig.height=4}
l_g_groupfm[[3]]
```


##### Urban/Rural
```{r labor_ur}
l_g_groupur[[1]]

```

###### {.sideby}
```{r fig.width=5, fig.height=4}
l_g_groupur[[2]]
```

###### {.sideby}
```{r fig.width=5, fig.height=4}
l_g_groupur[[3]]
```


<!-- ##### PSDP Treatment/Control  -->
<!-- ```{r labor_tc} -->
<!-- l_g_grouptc[[1]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- l_g_grouptc[[2]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- l_g_grouptc[[3]] -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r labor_oy} -->
<!-- l_g_groupoy[[1]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- l_g_groupoy[[2]] -->
<!-- ``` -->

<!-- ###### {.sideby} -->
<!-- ```{r fig.width=5, fig.height=4} -->
<!-- l_g_groupoy[[3]] -->
<!-- ``` -->

####

We measure weekly labor supply using total hours worked by the respondent in the last 7 days. The plot also shows hours worked in the last 7 days for agricultural activities, non-agricultural self-employment, and wage employment seperately.

  
***

<font size="5">**Child-Care Hours - past 7 days**</font>  

####  {.tabset .tabset-pills}

##### Full sample
```{r c_care}
ccpink<- "#f768a1"
cclightpink<- "#fa9fb5"

presOptions_lcc<- function(dygraph) {
  dygraph %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
    dyAxis("y", label = "Average Hours", drawGrid = FALSE, valueRange = c(0, 35)) %>% # 
    dyLegend(width = 550 , labelsSeparateLines = FALSE) %>%
    dyCrosshair(direction = "vertical") %>%
    dyCrosshair(direction = "vertical") %>%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>% 
    dyEvent(lockd_axis , "Lockdown begins March 15", labelLoc = "top") %>%
      dyOptions(stackedGraph = FALSE, includeZero = TRUE, axisLineWidth = 4, drawPoints = TRUE, pointSize = 4,  connectSeparatedPoints = TRUE) 
}


lcc_g <- dygraph(lcc, main = "") %>%
  dySeries("l5_tc", strokeWidth = 4, label = "Child-Care Hours", color = ccpink) %>%
 # dyOptions(colors = RColorBrewer::brewer.pal(4, "Dark2")) %>% 
  presOptions_lcc()%>% 
      dyLimit(limit = precovid_full$l5_childcarehrs_precovid, "              Child-Care Hours (2017-2019 avg.)", strokePattern = "dotted", color = c_pink)

lcc_g
```

##### Female/Male

```{r cc_fm}

lcc_g_group <- function(dataset, factor, pre_factor, text){
    lcc_var <- c("twoweeks", "l5_tc")
    v_ab <- data_group(dataset, lcc_var, factor)
    v_ab.col <- colnames(v_ab)
    
    precovid_a <- precovid %>%  
       filter(pre_factor == 1)
    precovid_b <- precovid %>%  
       filter(pre_factor == 0)
    
 lcc_g <- dygraph(v_ab, main = "") %>%
    dySeries(v_ab.col[2], strokeWidth = 4, label = paste0(text[1],": Child-Care Hours"), strokePattern = "dashed", color = ccpink) %>%
    dySeries(v_ab.col[3],strokeWidth = 4, label = paste0(text[2],": Child-Care Hours"), color = cclightpink) %>% # dyOptions(colors = RColorBrewer::brewer.pal(4, "Paired")
    presOptions_lcc() %>% 
    dyLimit(limit = precovid_a$l5_childcarehrs_precovid, paste0(text[1],":              Child-Care Hours (2017-2019 avg.)"), strokePattern = "dashed", color = ccpink) %>% 
    dyLimit(limit = precovid_b$l5_childcarehrs_precovid, paste0(text[2],":              Child-Care Hours (2017-2019 avg.)"), strokePattern = "dotted", color = cclightpink)

 lcc_g
}
  
lcc_g_fm <- lcc_g_group(covid_batch_mf, covid_batch_mf$female,     precovid$female, c("Female","Male"))
lcc_g_ur <- lcc_g_group(covid_batch_ur, covid_batch_ur$urban,      precovid$urban, c("Urban","Rural"))
lcc_g_tc <- lcc_g_group(covid_batch_tc, covid_batch_tc$psdp_treat, precovid$psdp_treat, c("Treatment","Control"))
lcc_g_oy <- lcc_g_group(covid_batch_oy, covid_batch_oy$older,      precovid$older, c('Older', 'Younger'))

lcc_g_fm
```


##### Urban/Rural
```{r lcc_ur}
lcc_g_ur
```


<!-- ##### PSDP Treatment/Control -->
<!-- ```{r lcc_tc} -->
<!-- lcc_g_tc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r lcc_oy} -->
<!-- lcc_g_oy -->
<!-- ``` -->

####

We ask for the number of hours spent doing childcare by the respondents in the last 7 days (even if it overlapped with other tasks).

***

<font size="5">**Unemployment and Layoffs**</font>  

####  {.tabset .tabset-pills}

##### Full sample
```{r labor_unemply}
presOptions_ue<- function(dygraph) {
  dygraph %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch,axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE , label = "Proportion of Households", valueRange = c(0,1.1)) %>% 
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
  dyLegend(width = 450, labelsSeparateLines = TRUE)   %>% 
  dyEvent(lockd_axis , "Lockdown begins March 15", labelLoc = "top") %>%

  dyOptions(axisLineWidth = 4, includeZero = TRUE,drawPoints = TRUE, pointSize = 4) #colors = RColorBrewer::brewer.pal(4, "Set1")
}

d_g  <- dygraph(ue, main = "") %>% #Unemployment and Layoffs
  dySeries("l6", strokeWidth = 4, label = "Unemployment (past 7 days)") %>%
  dySeries("l7", strokeWidth = 4, label = "Layoffs since March 2020") %>%
  dyOptions(colors = RColorBrewer::brewer.pal(4, "Set1"))%>%
  presOptions_ue()
d_g
```

##### Female/Male
```{r unemply_fm}
#func
la_g_group <- function(dataset, factor, group_label, title_text){
  v_ab <- data_group(dataset, c("twoweeks", "l6", "l7"), factor)
    v_ab.col <- colnames(v_ab)
  #graghing 
  g <- dygraph(v_ab, main = "", group = title_text) %>% # grouping
    dySeries(v_ab.col[2], strokeWidth = 4, label = group_label[1], strokePattern = "dashed", color = "red2") %>%
    dySeries(v_ab.col[4], strokeWidth = 4, label = group_label[3],color = "red2") %>%
    dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[2], strokePattern = "dashed", color = "dodgeblue3") %>%
    dySeries(v_ab.col[5], strokeWidth = 4, label = group_label[4], color = "dodgeblue3") %>%
    presOptions_ue() %>%
    dyOptions(colors = c("#E41A1C", "#E41A1C", "#377EB8", "#377EB8"))
}

la_glab_fm <- c("Female: Unemployment (past 7 days)", "Female: Layoffs since March 2020", "Male: Unemployment (past 7 days)", "Male: Layoffs since March 2020")

la_glab_ur <- c("Urban: Unemployment (past 7 days)", "Urban: Layoffs since March 2020", "Rural: Unemployment (past 7 days)", "Rural: Layoffs since March 2020")

la_glab_tc <- c("Treatment: Unemployment (past 7 days)", "Treatment: Layoffs since March 2020", "Control: Unemployment (past 7 days)", "Control: Layoffs since March 2020")

la_glab_oy <- c("Older: Unemployment (past 7 days)", "Older: Layoffs since March 2020", "Younger: Unemployment (past 7 days)", "Younger: Layoffs since March 2020")

ue_g_groupfm <- la_g_group(covid_batch_mf, covid_batch_mf$female, la_glab_fm, title_text = "by gender")

ue_g_groupur <- la_g_group(covid_batch_ur, factor = covid_batch_ur$urban, la_glab_ur, "Urban/Rural")

ue_g_grouptc <- la_g_group(covid_batch_tc, factor = covid_batch_tc$psdp_treat, la_glab_tc, "Treatment/Control")

ue_g_groupoy <- la_g_group(covid_batch_oy, factor = covid_batch_oy$older, la_glab_oy, "Older/Younger")

ue_g_groupfm
```

##### Urban/Rural
```{r unemply_ur}
ue_g_groupur
```

<!-- ##### PSDP Treatment/Control -->
<!-- ```{r unemply_tc} -->
<!-- ue_g_grouptc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r unemply_oy} -->
<!-- ue_g_groupoy -->
<!-- ``` -->

#### 

In this plot, layoffs describes the proportion of sampled households with members who have been laid off / lost their job involuntarily since March 2020. Unemployment describes the proportion of sampled households with members actively looking for paid work in the past 7 days.

*** 

### Food Security  

<font size="5">**Number of Days with Food Struggles - past 7 days**</font>

```{r struggles}
f1_d_g  <- dygraph(f1_d, main = "") %>%
  dySeries("f1_d_hungryadult", strokeWidth = 4, label = "Adults Gone to Bed Hungry") %>%
  dySeries("f1_d_hungrychild", strokeWidth = 4, label = "Children Gone to Bed Hungry") %>%
  dySeries("f1_d_skippedadult", strokeWidth = 4, label = "Adults Skipped Meals") %>%
  dySeries("f1_d_skippedchild", strokeWidth = 4, label = "Children Skipped Meals") %>%
  dySeries("f1_d_nofoodadult", strokeWidth = 4, label = "Adults Gone No Food") %>%
  dySeries("f1_d_nofoodchild", strokeWidth = 4, label = "Children Gone No Food") %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE , label = "Number of days", valueRange = c(0,3.5)) %>% 
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
  dyLegend(width = 300, labelsSeparateLines = TRUE) %>% 
      dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") %>%
  dyOptions(axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE,drawPoints = TRUE, pointSize = 4, colors = RColorBrewer::brewer.pal(6, "Paired"))
f1_d_g
```

####

We ask respondents the number days in the last 7 days on which any adults or any children (age <16) in the household have experienced food struggles, including going to bed hungry, skipping meals, and having no food.
 
***  
 
<font size="5">**Worry about Food - past 7 days**</font>

<!-- Treatment indivituals are those who received early treatment in Primary School Deworming Program (PSDP) during 1998-2001. Older and younger cohorts are specified within PSDP participants. -->


####  {.tabset .tabset-pills}

##### Full sample
```{r worry}

f1_w_g  <- dygraph(f1_w, main = "") %>%
  dySeries("f1_worry", strokeWidth = 4, label = "Worry about Not Enough Food") %>%
  dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE , label = "Number of days", valueRange = c(0,1.1)) %>% 
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
  dyLegend(width = 300, labelsSeparateLines = TRUE) %>% 
        dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") %>%
    dyOptions(axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE,drawPoints = TRUE, pointSize = 4, colors = RColorBrewer::brewer.pal(6, "Set1")) 
f1_w_g
```

##### Female/Male 
```{r worry_fm}
f1_w_group <- function(dataset, factor, text){
    f1w_var <- c("twoweeks", "f1_worry")
    v_ab <- data_group(dataset, f1w_var, factor)
    v_ab.col <- colnames(v_ab)
 f1_w <- dygraph(v_ab, main = "") %>%
  dySeries(v_ab.col[2], strokeWidth = 4, label = paste0(text[1],": Worry about Not Enough Food"),strokePattern = "dashed") %>%
  dySeries(v_ab.col[3], strokeWidth = 4, label = paste0(text[2],":  Worry about Not Enough Food")) %>%
  dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE , label = "Number of days", valueRange = c(0,1.1)) %>% 
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
  dyLegend(width = 300, labelsSeparateLines = TRUE) %>% 
         dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") %>%
    dyOptions(axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE, drawPoints = TRUE, pointSize = 4, colors = c("#E31A1C","#FB9A99")) 

f1_w
}
  
f1_w_fm <- f1_w_group(covid_batch_mf_nospace, covid_batch_mf_nospace$female, c("Female","Male"))
f1_w_ur <- f1_w_group(covid_batch_ur_nospace, covid_batch_ur_nospace$urban, c("Urban","Rural"))
f1_w_tc <- f1_w_group(covid_batch_tc_nospace, covid_batch_tc_nospace$psdp_treat, c("Treatment","Control"))
f1_w_oy <- f1_w_group(covid_batch_oy_nospace, covid_batch_oy_nospace$older, c("Older","Younger"))

f1_w_fm
```


##### Urban/Rural
```{r worry_ur}
f1_w_ur
```


<!-- ##### PSDP Treatment/Control -->
<!-- ```{r worry_tc} -->
<!-- f1_w_tc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r worry__oy} -->
<!-- f1_w_oy -->
<!-- ``` -->

####

This plot shows the proportion of respondents who, in the last 7 days, worried that their household would not have enough food. 

*** 
 

 <font size="5">**Proportion of Households Having Meals include:**</font>  

####  {.tabset .tabset-pills}

##### Full sample

```{r meat, echo=FALSE}
f1_meals_g  <- dygraph(f1_meals, main = "") %>%
  dySeries("f1_meat", strokeWidth = 4, label = "Meat or Fish") %>%
  dySeries("f1_eggs", strokeWidth = 4, label = "Eggs") %>%
   dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
   dyAxis("y", drawGrid = FALSE , label = "Proportion of Households", valueRange = c(0:1)) %>% 
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
  dyLegend(width = 300, labelsSeparateLines = TRUE) %>% 
        dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") %>%
    dyOptions(axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE,drawPoints = TRUE, pointSize = 4, colors = RColorBrewer::brewer.pal(4, "Set1")) 
f1_meals_g
```   

##### Female/Male 
```{r meat_fm}
f1_meals_group <- function(dataset, factor, text){
    f1w_var <- c("twoweeks", "f1_meat", "f1_eggs")
    v_ab <- data_group(dataset, f1w_var, factor)
    v_ab.col <- colnames(v_ab)
 f1_w <- dygraph(v_ab, main = "") %>%
  dySeries(v_ab.col[2], strokeWidth = 4, label = paste0(text[1],": Meat or Fish"), strokePattern = "dashed") %>%
  dySeries(v_ab.col[4], strokeWidth = 4, label = paste0(text[2],": Meat or Fish")) %>%
      dySeries(v_ab.col[3], strokeWidth = 4, label = paste0(text[1],": Eggs"),strokePattern = "dashed") %>%
      dySeries(v_ab.col[5], strokeWidth = 4, label = paste0(text[2],":  Eggs")) %>%
  dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE , label = "Proportion of Households", valueRange = c(0:1.2)) %>% 
  dyOptions(axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE,drawPoints = TRUE, pointSize = 4, colors = c("#E41A1C" ,"#E41A1C","#377EB8", "#377EB8")) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
         dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") %>%
  dyLegend(width = 300, labelsSeparateLines = TRUE)
 
 f1_w
}

  
f1_meals_fm <- f1_meals_group(covid_batch_mf_nospace, covid_batch_mf_nospace$female, c("Female","Male"))
f1_meals_ur <- f1_meals_group(covid_batch_ur_nospace, covid_batch_ur_nospace$urban, c("Urban","Rural"))
f1_meals_tc <- f1_meals_group(covid_batch_tc_nospace, covid_batch_tc_nospace$psdp_treat, c("Treatment","Control"))
f1_meals_oy <- f1_meals_group(covid_batch_oy_nospace, covid_batch_oy_nospace$older, c("Older","Younger"))

f1_meals_fm
```


##### Urban/Rural
```{r meat_ur}
f1_meals_ur
```


<!-- ##### PSDP Treatment/Control -->
<!-- ```{r meat_tc} -->
<!-- f1_meals_tc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r meat_oy} -->
<!-- f1_meals_oy -->
<!-- ``` -->

####

We ask respondents whether any of the meals the household ate the day before included a)meat or fish, b)eggs.
  
*** 


<font size="5">**Food Security Index**</font>


####  {.tabset .tabset-pills}

##### Full sample

```{r food_index}
color_f1index <- c("#E41A1C","#5ac0c3","#085b8d")

f1_idx_g  <- dygraph(f1_idx, main = "") %>%
  dySeries("f1", strokeWidth = 4, label = "Food Security Index", pointShape = 'square') %>%
  dySeries("f4", strokeWidth = 4, label = "Adults Food Security Index") %>%
  dySeries("f3", strokeWidth = 4, label = "Children Food Security Index") %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE , label = "Index", valueRange = c(-0.5,0.5)) %>% 
  dyOptions(axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE,drawPoints = TRUE, pointSize = 4, colors = color_f1index) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
  dyLegend(width = 300, labelsSeparateLines = TRUE) %>% 
  dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top")

f1_idx_g
```

##### Female/Male {.few .dygraph-legend}
```{r f1_index_fm}
color_shade6 <- c("#a50f15","#E41A1C", "#08519c","#377EB8", "#00441b" ,"#4DAF4A" )
color_regular <- c("#E41A1C" ,"#E41A1C","#5ac0c3","#5ac0c3", "#085b8d","#085b8d")

f1_index_group <- function(dataset, factor, text){
    f1w_var <- colnames(f1_idx)
    v_ab <- data_group(dataset, f1w_var, factor)
    v_ab.col <- colnames(v_ab)
 f1_w <- dygraph(v_ab, main = "") %>%
    dySeries(v_ab.col[2], strokeWidth = 4, label = paste0(text[1],": Food Security Index"), strokePattern = "dashed") %>%
    dySeries(v_ab.col[5], strokeWidth = 4, label = paste0(text[2],": Food Security Index")) %>%
  dySeries(v_ab.col[4], strokeWidth = 4, label = paste0(text[1],": Adults Food Security Index"),strokePattern = "dashed") %>%
  dySeries(v_ab.col[7], strokeWidth = 4, label = paste0(text[2],": Adults Food Security Index")) %>%
  dySeries(v_ab.col[3], strokeWidth = 4, label = paste0(text[1],": Children Food Security Index"),strokePattern = "dashed") %>%
      dySeries(v_ab.col[6], strokeWidth = 4, label = paste0(text[2],":  Children Food Security Index")) %>%
  dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE , label = "Proportion of Households", valueRange = c(-0.5,0.5)) %>% 
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
  dyLegend(width =300, labelsSeparateLines = TRUE) %>% 
         dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") %>%
     dyOptions(axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE,drawPoints = TRUE, pointSize = 4, colors =  color_regular)
   
f1_w
}
  
f1_index_fm <- f1_index_group(covid_batch_mf_nospace, covid_batch_mf_nospace$female, c("Female","Male"))
f1_index_ur <- f1_index_group(covid_batch_ur_nospace, covid_batch_ur_nospace$urban, c("Urban","Rural"))
f1_index_tc <- f1_index_group(covid_batch_tc_nospace, covid_batch_tc_nospace$psdp_treat, c("Treatment","Control"))
f1_index_oy <- f1_index_group(covid_batch_oy_nospace, covid_batch_oy_nospace$older, c("Older","Younger"))

f1_index_fm
```


##### Urban/Rural {.few .dygraph-legend}
```{r f1_index_ur}
f1_index_ur
```


<!-- ##### PSDP Treatment/Control {.few .dygraph-legend} -->
<!-- ```{r f1_index_tc} -->
<!-- f1_index_tc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger {.few .dygraph-legend} -->
<!-- ```{r f1_index_oy} -->
<!-- f1_index_oy -->
<!-- ``` -->

####

We construct the food security index following Anderson (2008), which includes the number of days experiencing food struggle, indictor for worrying about food, and meal quality. Greater index values indicate greater food security. This index is standardized with a weighted mean of 0 and a standard deviation of 1.


***

### COVID-19  

<font size="5">**COVID-19 Prevalence**</font>

<!-- Treatment indivituals are those who received early treatment in Primary School Deworming Program (PSDP) during 1998-2001. Older and younger cohorts are specified within PSDP participants. -->

####  {.tabset .tabset-pills}

##### Full sample

```{r prevalence, echo=FALSE}

presOptions_prevalence<- function(dygraph) {
  dygraph %>%  
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
    dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents", valueRange = c(0,0.21)) %>% #grid
    dyLegend(width = 400, labelsSeparateLines = TRUE) %>%
    dyOptions(axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE, drawPoints = TRUE, pointSize = 4)%>%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
 #   dyEvent(1.7 , "Face masks mandatory", labelLoc = "bottom") %>%
    dyCrosshair(direction = "vertical") %>% 
          dyEvent(lockd_axis_less, "Lockdown begins March 15", labelLoc = "top")
}

prevalence_g <- dygraph(prevalence, main = "") %>%
   dySeries("cs1", strokeWidth = 4, label = "HH Member Contracted", color = "#d95f02") %>%
   dySeries("cs2", strokeWidth = 4, label = "Know Someone (non-HH) Contracted", color = "#7570b3") %>%
   presOptions_prevalence()
prevalence_g
```

##### Female/Male
```{r covp_fm}
#func
covp_g_group <- function(dataset, factor, group_label, title_text){
  v_ab <- data_group(dataset, colnames(prevalence), factor)
    v_ab.col <- colnames(v_ab)

g <- dygraph(v_ab, main = "") %>% # 
    dySeries(v_ab.col[2], strokeWidth = 4, label = group_label[1], strokePattern = "dashed", color = "red2") %>%
    dySeries(v_ab.col[4], strokeWidth = 4, label = group_label[3],color = "red2") %>%
    dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[2], strokePattern = "dashed", color = "dodgeblue3") %>%
    dySeries(v_ab.col[5], strokeWidth = 4, label = group_label[4], color = "dodgeblue3") %>%
    presOptions_prevalence() %>%
    dyOptions(colors = c("#d95f02", "#fc8d62", "#7570b3", "#8da0cb"),axisLineWidth = 4, includeZero = TRUE, connectSeparatedPoints = FALSE, drawPoints = TRUE, pointSize = 4)
}

covp_glab_fm <- c("Female: HH Member Contracted", "Female: Know someone (non-HH) Contracted", "Male: HH Member Contracted", "Male: Know someone (non-HH) Contracted")

covp_glab_ur <- c("Urban: HH Member Contracted", "Urban: Know someone (non-HH) Contracted", "Rural: HH Member Contracted", "Rural: Know someone (non-HH) Contracted")

covp_glab_tc <- c("Treatment: HH Member Contracted", "Treatment: Know someone (non-HH) Contracted", "Control: HH Member Contracted", "Control: Know someone (non-HH) Contracted")

covp_glab_oy <- c("Older: HH Member Contracted", "Older: Know someone (non-HH) Contracted", "Younger: HH Member Contracted", "Younger: Know someone (non-HH) Contracted")


covp_g_groupfm <- covp_g_group(covid_batch_mf_nospace, covid_batch_mf_nospace$female, covp_glab_fm, title_text = "by gender")

covp_g_groupur <- covp_g_group(covid_batch_ur_nospace, factor = covid_batch_ur_nospace$urban, covp_glab_ur, "Urban/Rural")

covp_g_grouptc <- covp_g_group(covid_batch_tc_nospace, factor = covid_batch_tc_nospace$psdp_treat, covp_glab_tc, "Treatment/Control")

covp_g_groupoy <- covp_g_group(covid_batch_oy_nospace, factor = covid_batch_oy_nospace$older, covp_glab_oy, "Older/Younger")

 covp_g_groupfm
```


##### Urban/Rural
```{r covp_ur}
covp_g_groupur
```


<!-- ##### PSDP Treatment/Control -->
<!-- ```{r covp_tc} -->
<!-- covp_g_grouptc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r covp_oy} -->
<!-- covp_g_groupoy -->
<!-- ``` -->

####

The above prevalence measures whether the respondent personally knows someone who has contracted COVID-19 from inside the household (self included) and from outside the household.  


***

<font size="5">**Reported COVID-19 Knowledge**</font>

####  {.tabset .tabset-pills}

##### Full sample 


```{r knowledge, echo=FALSE}
ckn_lab <- c("Prevention Measures Correct", "Prevention Measures Incorrect", "Symptoms Correct", "Symptoms Incorrect")


presOptions_ckn<- function(dygraph) {
  dygraph %>%  
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
    dyAxis("y", drawGrid = FALSE, label = "Sum of Answers", valueRange = c(0,6.5)) %>% 
    dyLegend(width = 300, labelsSeparateLines = TRUE) %>%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
 #   dyEvent(1.7 , "Face masks mandatory", labelLoc = "bottom") %>%
    dyCrosshair(direction = "vertical") %>% 
          dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") 
}

ckn_g <- dygraph(ckn, main = "") %>%
  dySeries("ckn1", strokeWidth = 4, label = ckn_lab[1],  color = "#41ab5d") %>% 
  dySeries("ckn2", strokeWidth = 4, label = ckn_lab[2], color = "#41ab5d") %>% 
  dySeries("ckn3", strokeWidth = 4, label = ckn_lab[3], color = "#807dba") %>%
  dySeries("ckn4", strokeWidth = 4, label = ckn_lab[4],color = "#807dba") %>% 
    presOptions_ckn() %>% 
  dyOptions(axisLineWidth = 4, includeZero = TRUE, drawPoints = TRUE, pointSize = 4, colors =   c("#43a2ca","#9ecae1","#ec7014","#fec44f"))
ckn_g

```

##### Female/Male {.few .dygraph-legend}
```{r ckn_fm}

ckn_g_group <- function(dataset, factor, group_label, title_text){
  v_ab <- data_group(dataset, colnames(ckn), factor) # c("twoweeks","ckn1","ckn2","ckn3","ckn4")
    v_ab.col <- colnames(v_ab)
  #graghing 
  g <- dygraph(v_ab, main = "") %>% # grouping
    dySeries(v_ab.col[2], strokeWidth = 4, label = group_label[1], strokePattern = "dashed") %>%
    dySeries(v_ab.col[4], strokeWidth = 4, label = group_label[3], strokePattern = "dashed") %>%
    dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[2], strokePattern = "dashed") %>%
    dySeries(v_ab.col[5], strokeWidth = 4, label = group_label[4], strokePattern = "dashed") %>%
        dySeries(v_ab.col[6], strokeWidth = 4, label = group_label[5]) %>%
    dySeries(v_ab.col[7], strokeWidth = 4, label = group_label[6]) %>%
    dySeries(v_ab.col[8], strokeWidth = 4, label = group_label[7]) %>%
    dySeries(v_ab.col[9], strokeWidth = 4, label = group_label[8]) %>%
   presOptions_ckn() %>% 
    dyOptions(colors = c("#43a2ca","#9ecae1","#ec7014","#fec44f","#43a2ca","#9ecae1","#ec7014","#fec44f"), axisLineWidth = 4, includeZero = TRUE, drawPoints = TRUE, pointSize = 4)
}

ckn_glab_fm <- c("Female: Prevention Measures Correct", "Female: Prevention Measures Incorrect","Female: Symptoms Correct ","Female: Symptoms Incorrect", "Male: Prevention Measures Correct", "Male: Prevention Measures Incorrect","Male: Symptoms Correct ","Male: Symptoms Incorrect")

ckn_glab_ur <- c("Urban: Prevention Measures Correct", "Urban: Prevention Measures Incorrect","Urban: Symptoms Correct ","Urban: Symptoms Incorrect", "Rural: Prevention Measures Correct", "Rural: Prevention Measures Incorrect","Rural: Symptoms Correct ","Rural: Symptoms Incorrect")

ckn_glab_tc <- c("Treatment: Prevention Measures Correct", "Treatment: Prevention Measures Incorrect","Treatment: Symptoms Correct ","Treatment: Symptoms Incorrect", "Control: Prevention Measures Correct", "Control: Prevention Measures Incorrect","Control: Symptoms Correct ","Control: Symptoms Incorrect")

ckn_glab_oy <- c("Older: Prevention Measures Correct", "Older: Prevention Measures Incorrect","Older: Symptoms Correct ","Older: Symptoms Incorrect", "Younger: Prevention Measures Correct", "Younger: Prevention Measures Incorrect","Younger: Symptoms Correct ","Younger: Symptoms Incorrect")

ckn_g_groupfm <- ckn_g_group(covid_batch_mf_nospace, covid_batch_mf_nospace$female, ckn_glab_fm, title_text = "by gender")

ckn_g_groupur <- ckn_g_group(covid_batch_ur_nospace, factor = covid_batch_ur_nospace$urban, ckn_glab_ur, "Urban/Rural")

ckn_g_grouptc <- ckn_g_group(covid_batch_tc_nospace, factor = covid_batch_tc_nospace$psdp_treat, ckn_glab_tc, "Treatment/Control")

ckn_g_groupoy <- ckn_g_group(covid_batch_oy_nospace, factor = covid_batch_oy_nospace$older, ckn_glab_oy, "Older/Younger")

ckn_g_groupfm
```


##### Urban/Rural {.few .dygraph-legend}
```{r ckn_ur}
ckn_g_groupur
```


<!-- ##### PSDP Treatment/Control {.few .dygraph-legend} -->
<!-- ```{r ckn_tc} -->
<!-- ckn_g_grouptc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger {.few .dygraph-legend} -->
<!-- ```{r ckn_oy} -->
<!-- ckn_g_groupoy -->
<!-- ``` -->

####   

We ask respondents about the symptoms of COVID-19 and prevention measures of COVID-19. We record the number of correct symptoms/measures and incorrect symptoms/measures answered.

***

<font size="5">**Reported COVID-19 Behavior Changes**</font>

```{r behavior_changes, echo=FALSE}
  cbc_col <- c("Having Changed Behavior","“Correct” Behavioral Changes","“Incorrect” Behavioral Changes")
  colnames(cbc)[2:4] <- cbc_col
  
cbc_g <- dygraph(cbc, main = "") %>% 
    dySeries(cbc_col[1], strokeWidth = 4, label = "Having Changed Behavior",axis = 'y', color = "#4292c6") %>%
    # dySeries("cbc2", strokeWidth = 4, label = "“Correct” Behavioral Changes",axis = 'y2') %>%
    # dySeries("cbc3", strokeWidth = 4, label = " “Incorrect” Behavioral Changes",axis = 'y2') %>%
  dyMultiColumnGroup(cbc_col[2:3], axis = 'y2', color = c('#74c476',"#fb6a4a"))%>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
    dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents",rangePad = 2, valueRange = c(0,1.1)) %>% #grid
    dyAxis("y2", drawGrid = FALSE, label = "Sum of Answers", valueRange = c(0,7), independentTicks = TRUE,rangePad = 2) %>% #grid
    dyLegend(width = 400) %>%
    dyOptions(axisLineWidth = 4, includeZero = TRUE, drawPoints = TRUE, pointSize = 4)%>%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
 #   dyEvent(1.7 , "Face masks mandatory", labelLoc = "bottom") %>%
    dyCrosshair(direction = "vertical") %>% 
        dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") 
cbc_g
```
   
 We ask respondents whether they have changed their behavior in any way since learning about COVID-19, and if so, how have they changed. “Correct” means that the behavior would reduce risk of contracting COVID-19 and “Incorrect” means irrelevant. We record the sum of correct behavior changes answered and the sum of incorrect behavior changes answered.
  
***


<font size="5">**Reported COVID-19 Symptoms, past 14 days**</font>

``` {r symptoms}
cov1_g <- dygraph(cov1, main = "") %>% 
  dySeries("cov1_fever", strokeWidth = 4, label = "Fever") %>%
  dySeries("cov1_tired", strokeWidth = 4, label = "Tired") %>%
  dySeries("cov1_cough", strokeWidth = 4, label = "Cough") %>%
  dySeries("cov1_dbreath", strokeWidth = 4, label = "Difficulty Breathing") %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents") %>% #grid
  dyLegend(width = 500) %>%
  dyOptions(axisLineWidth = 4, includeZero = TRUE, drawPoints = TRUE, pointSize = 4, colors = RColorBrewer::brewer.pal(4, "Set2")) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>% 
        dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top")
cov1_g
```
  
####

We ask respondents whether they or any other household members have experienced any illnesses or symptoms on a given list in the past 14 days. 

*** 



<font size="5">**Social Interactions (outside household)**</font>

####  {.tabset .tabset-pills}

##### Full sample

```{r interactions, echo=FALSE}
net5_g  <- dygraph(s3, main = "") %>%
  dySeries("s3_4travel", strokeWidth = 4, label = "Travel to Another Town or City - past 14 days") %>%
#  dySeries("net5_last7_wins", strokeWidth = 4, label = "In the past 7 days") %>%
#  dySeries("net5_today_wins", strokeWidth = 4, label = "Today") %>%
  dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
  dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents", valueRange = c(0,0.3)) %>% 
  dyLegend(width = 500) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
    dyOptions(axisLineWidth = 4, includeZero = TRUE, drawPoints = TRUE, pointSize = 4, colors = RColorBrewer::brewer.pal(4, "Set1")) %>% 
        dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") 

net5_g
```

##### Female/Male

```{r inter_fm}
inter_g_group <- function(dataset, factor, group_label, title_text){
  # Variable prep, careful with the order and v_ab[]
  v_ab <- data_group(dataset, c("twoweeks", "s3_4travel"), factor)
    v_ab.col <- colnames(v_ab)
  #graghing 
  g <- dygraph(v_ab) %>% #, main = paste0("Transfers per capita, " , title_text)) %>% #, group = title_text) %>% # grouping
    dySeries(v_ab.col[2], strokeWidth = 4, label = group_label[1], strokePattern = "dashed") %>%
    dySeries(v_ab.col[3], strokeWidth = 4, label = group_label[2] ) %>%
    dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch, axisLabelFontSize = 12) %>% 
    dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents", valueRange = c(0,0.3)) %>% 
    dyLegend(width = 500, labelsSeparateLines = TRUE) %>%
    dyCrosshair(direction = "vertical") %>%
    dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
          dyEvent(lockd_axis_less , "Lockdown begins March 15", labelLoc = "top") %>% 
     dyOptions(axisLineWidth = 4, includeZero = TRUE, drawPoints = TRUE, pointSize = 4, colors = c("#E41A1C","#E41A1C"), rightGap = 20)
}

inter_glab_fm <- c("Female: Travel to Another Town or City - past 14 days", "Male:Travel to Another Town or City - past 14 days")

inter_glab_ur <- c("Urban: Travel to Another Town or City - past 14 days", "Rural: Travel to Another Town or City - past 14 days")

inter_glab_tc <- c("Treatment: Travel to Another Town or City - past 14 days", "Control: Travel to Another Town or City - past 14 days")

inter_glab_oy <- c("Older: Travel to Another Town or City - past 14 days", "Younger: Travel to Another Town or City - past 14 days")

inter_g_groupfm <- inter_g_group(covid_batch_mf_nospace, covid_batch_mf_nospace$female, inter_glab_fm)

inter_g_groupur <- inter_g_group(covid_batch_ur_nospace, factor = covid_batch_ur_nospace$urban, inter_glab_ur)

inter_g_grouptc <- inter_g_group(covid_batch_tc_nospace, factor = covid_batch_tc_nospace$psdp_treat, inter_glab_tc)

inter_g_groupoy <- inter_g_group(covid_batch_oy_nospace, factor = covid_batch_oy_nospace$older, inter_glab_oy)

inter_g_groupfm
```

##### Urban/Rural  
```{r inter_ur}
inter_g_groupur
```

<!-- ##### PSDP Treatment/Control   {.dygraph-legend_left}  -->
<!-- ```{r inter_tc} -->
<!-- inter_g_grouptc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r inter_oy} -->
<!-- inter_g_groupoy -->
<!-- ``` -->

####

We ask respondents whether they have traveled to (and returned from) another town or city in the past 14 days.

***  


### Mental Health

<font size="5">**Reported Mental Health**</font>


```{r mh_all, echo=FALSE}
mh <- c("twoweeks", 'nervous' ,'lonely', 'hopeful', 'phyreaction','depressed')
mh <- covid_batch[mh]

presOptions_mh <- function(dygraph){
  dygraph %>% 
  dyAxis("x", pixelsPerLabel = 40 , drawGrid = FALSE, label = "Date (batch median)", rangePad = 10, valueFormatter = htmlwidgets::JS(getMedianDate), ticker = tickers_batch,axisLabelFontSize = 12) %>% 
  dyOptions(strokeWidth = 4, axisLineWidth = 4, includeZero = TRUE, drawPoints = TRUE, pointSize = 4, strokeBorderWidth = 1) %>%
  dyCrosshair(direction = "vertical") %>%
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))  %>% 
          dyEvent(lockd_axis , "Lockdown begins March 15", labelLoc = "top") 
}


mh_graph_tg <- function(){
  labs <- c(" ",'Nervous' ,'Lonely', 'Hopeful', 'Physical Reaction', 'Depressed')
  mhcol <- colnames(mh)
  #graghing 
  g_a <- dygraph(mh, main = "") %>% 
  dySeries(mhcol[1], label = labs[1]) %>% 
  dySeries(mhcol[2], label = labs[2]) %>% 
  dySeries(mhcol[3], label = labs[3]) %>% 
  dySeries(mhcol[4], label = labs[4]) %>% 
  dySeries(mhcol[6], label = labs[6])    %>% 
  dySeries(mhcol[5], label = labs[5])    %>% 
  dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents") %>% 
  dyLegend(width = 500) %>%
  dyOptions(colors = RColorBrewer::brewer.pal(6, "Set2"))%>%
  presOptions_mh()  
 g_a
}

# graph all questions together
mh_graph_tg()

```

```{r mh_fullsample, echo=FALSE}
mhcolor <- c("#66C2A5","#66C2A5", "#FC8D62", "#8DA0CB", "#E78AC3", "#41ab5d","#B3E2CD", "#FDCDAC", "#9e9ac8", "#fa9fb5", "#74c476")
  
mh_graph <- function(i){
  labs <- c(" ", 'Nervous' ,'Lonely', 'Hopeful', 'Physical Reaction','Depressed')
  mhcol <- colnames(mh)
  #graghing 
  g_a <- dygraph(mh[,c(1,i)], main = "", group = "mh") %>% 
  dySeries(mhcol[i], strokeWidth = 4, label = labs[i])    %>% 
  dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents", valueRange = c(0,1.1)) %>% 
  dyLegend(width = 500) %>%
  dyOptions(colors = mhcolor[i])%>%
  presOptions_mh()  
 g_a
}
```

```{r mh_group, echo=FALSE}
mh_g_group <- function(i, mhg, text){
  labs <- c(" ",'Nervous' ,'Lonely', 'Hopeful', 'Physical Reaction','Depressed')
  mhcol <- colnames(mhg)
  #graghing 
  g_a <- dygraph(mhg[,c(1,i,i+5)],main = "") %>% 
  dySeries(mhcol[i], strokeWidth = 4, label = paste0(text[1],": ",labs[i]), strokePattern = "dashed", color = mhcolor[i])  %>% 
  dySeries(mhcol[i+5], strokeWidth = 4, label = paste0(text[2],": ",labs[i]), color = mhcolor[i+5])    %>% 
  dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents", valueRange = c(0,1.1) ) %>% 
  dyLegend(width = 500) %>%
  presOptions_mh()
g_a
  }

mh_g_all <- function(dataset, factor, text){
      mh_var <- c("twoweeks", 'nervous' ,'lonely', 'hopeful', 'phyreaction','depressed')
      mhg1 <- data_group(dataset, mh_var, factor)
      mh_list <- lapply(1:6, function(x){g <- mh_g_group(x,mhg1,text)})
  }
mhg_mf <- mh_g_all(covid_batch_mf, covid_batch_mf$female, c("Female","Male"))
mhg_ur <- mh_g_all(covid_batch_ur, covid_batch_ur$urban, c("Urban","Rural"))
mhg_tc <- mh_g_all(covid_batch_tc, covid_batch_tc$psdp_treat, c("Treatment","Control"))
mhg_oy <- mh_g_all(covid_batch_oy, covid_batch_oy$older, c('Older', 'Younger'))
## mhg_mf[[1]] empty to keep consistent index

```


#### 

We asked questions 1-5 on core mental health from the John Hopkins Bloomberg School of Public Health (JHSPH) [resource](https://www.elizabethstuart.org/files/MH_survey-items-request_03_20.pdf).  

See below for more detailed information for each aspect.

***


<font size="5">**Depression, CESD-10 (Subsample)**</font>


####  {.tabset .tabset-pills}

##### Full sample
```{r depressed}
mh_dps <- c('twoweeks', 'depressed','cesd_a','cesd_a_std')
mh_dps <- covid_batch[mh_dps]

mh_cesd_dps <- mh_dps %>% 
  mutate(lwr = cesd_a - 2*cesd_a_std, upr = cesd_a + 2*cesd_a_std) %>% 
  select(-cesd_a_std)

mh_dps <- dygraph(mh_cesd_dps, main = "") %>% #main = "Subsample CESD survey"
  dySeries('depressed', strokeWidth = 4, label = "Depressed")%>% 
  dySeries(c("lwr", "cesd_a", "upr"), strokeWidth = 4, label = "CESD Score", axis = "y2") %>%
  dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents", valueRange = c(0,1.1)) %>% #, valueRange = c(0,5.5)) %>% 
  dyAxis("y2", drawGrid = FALSE, label = "Average Score", valueRange = c(0,9.5)) %>% 
  dyLegend(width = 400) %>%
  presOptions_mh() 

mh_dps
# In Groups only CESD
```

##### Female/Male
```{r}
mh_g_dps <- function(dataset, factor, labs){
  mh_dps <- c("twoweeks", 'depressed','cesd_a','cesd_a_std')
  v_ab <- data_group(dataset, mh_dps, factor)
  v_ab <- v_ab %>% 
    mutate(lwr.0 = cesd_a.0 - 2*cesd_a_std.0, upr.0 = cesd_a.0 + 2*cesd_a_std.0) %>% 
    mutate(lwr.1 = cesd_a.1 - 2*cesd_a_std.1, upr.1 = cesd_a.1 + 2*cesd_a_std.1) %>% 
    select(-cesd_a_std.0,-cesd_a_std.1)
  v_ab_col <- colnames(v_ab)

mh_dps <- dygraph(v_ab[c("twoweeks","depressed.1","depressed.0")], main = "") %>% #main = "Subsample CESD survey"
  dySeries('depressed.1', strokeWidth = 4, label = labs[1], strokePattern = "dashed")%>% 
 # dySeries(c("lwr.1", "cesd_a.1", "upr.1"), strokeWidth = 4, label = labs[2], axis = "y2") %>%
    dySeries('depressed.0', strokeWidth = 4, label = labs[3])%>% 
#  dySeries(c("lwr.0", "cesd_a.0", "upr.0"), strokeWidth = 4, label = labs[4], axis = "y2") %>%
  dyAxis("y", drawGrid = FALSE, label = "Proportion of Respondents", valueRange = c(0,1.1)) %>% #, valueRange = c(0,5.5)) %>% 
  dyAxis("y2", drawGrid = FALSE, label = "Average Score", valueRange = c(0,9.5)) %>% 
  dyLegend(width = 400) %>%
  presOptions_mh() %>% 
  dyOptions(strokeWidth = 4, axisLineWidth = 4, includeZero = TRUE, drawPoints = TRUE, pointSize = 4, strokeBorderWidth = 1, colors = c("#4a1486","#6a51a3"))

mh_dps
  }

dp_glab_mf <- c("Female: Depressed", "Female: CESD Score", "Male: Depressed", "Male: CESD Score")

dp_glab_ur <- c("Urban: Depressed", "Urban: CESD Score", "Rural: Depressed", "Rural: CESD Score")

dp_glab_tc <- c("Treatment: Depressed", "Treatment: CESD Score", "Control: Depressed", "Control: CESD Score")

dp_glab_oy <- c("Older: Depressed", "Older: CESD Score", "Younger: Depressed", "Younger: CESD Score")


mh_g_dps_mf <- mh_g_dps(covid_batch_mf, covid_batch_mf$female, dp_glab_mf)
mh_g_dps_ur <- mh_g_dps(covid_batch_ur, covid_batch_ur$urban, dp_glab_ur)
mh_g_dps_tc <- mh_g_dps(covid_batch_tc, covid_batch_tc$psdp_treat, dp_glab_tc)
mh_g_dps_oy <- mh_g_dps(covid_batch_oy, covid_batch_oy$older, dp_glab_oy)

mh_g_dps_mf
```


##### Urban/Rural 
```{r}
mh_g_dps_ur
```

<!-- ##### PSDP Treatment/Control   -->
<!-- ```{r} -->
<!-- mh_g_dps_tc -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r} -->
<!-- mh_g_dps_oy -->
<!-- ``` -->

####
The **Centre for Epidemiological Studies Depression Scale** (CESD-10) is a 10-item Likert scale questionnaire assessing depressive symptoms in the past week. It includes three items on depressed affect, five items on somatic symptoms, and two on positive affect. Options for each item range from “rarely or none of the time” (score of 0) to “all of the time” (score of 3). Scoring is reversed for positive affect statements. Total scores can range from 0 to 30. **Higher scores suggest greater severity of symptoms.** A subset of respondents receive the CESD survey.
   
The depressed Index is generated from the question: In the past 7 days, have you ever felt hopeful about the future?

***

<font size="5">**Nervous, Anxious or on Edge**</font>

####  {.tabset .tabset-pills}

##### Full sample
```{r}
mh_graph(2)
```

##### Female/Male
```{r}
mhg_mf[[2]]
```

##### Urban/Rural 
```{r}
mhg_ur[[2]]
```

<!-- ##### PSDP Treatment/Control   -->
<!-- ```{r} -->
<!-- mhg_tc[[2]] -->
<!-- ``` -->


<!-- ##### PSDP Older/Younger -->
<!-- ```{r} -->
<!-- mhg_oy[[2]] -->
<!-- ``` -->

####

In the past 7 days, have you ever felt nervous, anxious, or on edge? 

***

<font size="5">**Lonely**</font>

####  {.tabset .tabset-pills}


##### Full sample
```{r}
mh_graph(3)
```

##### Female/Male
```{r}
mhg_mf[[3]]
```

##### Urban/Rural 
```{r}
mhg_ur[[3]]
```

<!-- ##### PSDP Treatment/Control  -->
<!-- ```{r} -->
<!-- mhg_tc[[3]] -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r} -->
<!-- mhg_oy[[3]] -->
<!-- ``` -->

####

In the past 7 days, have you ever felt lonely?

***

<font size="5">**Hopeful**</font>

####  {.tabset .tabset-pills}


##### Full sample  
```{r}
mh_graph(4)
```

##### Female/Male  
```{r}
mhg_mf[[4]]
```

##### Urban/Rural   
```{r}
mhg_ur[[4]]
```

<!-- ##### PSDP Treatment/Control    -->
<!-- ```{r} -->
<!-- mhg_tc[[4]] -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r} -->
<!-- mhg_oy[[4]] -->
<!-- ``` -->

####

In the past 7 days, have you ever felt hopeful about the future?

***

<font size="5">**Physical Reaction**</font>


####  {.tabset .tabset-pills}

##### Full sample  
```{r}
mh_graph(5)
```

##### Female/Male  
```{r}
mhg_mf[[5]]
```

##### Urban/Rural   
```{r}
mhg_ur[[5]]
```

<!-- ##### PSDP Treatment/Control    -->
<!-- ```{r} -->
<!-- mhg_tc[[5]] -->
<!-- ``` -->

<!-- ##### PSDP Older/Younger -->
<!-- ```{r} -->
<!-- mhg_oy[[5]] -->
<!-- ``` -->

####

In the past 7 days, have you ever had physical reactions, such as sweating, trouble breathing, nausea, or a pounding heart, when thinking about your experience (e.g., social distancing, loss of income/work, concerns about infection) with the coronavirus/COVID-19 pandemic?

***

<!-- NOTE: Skipped. Data not available -->


<!-- ### Survey Distribution -->


<!-- <font size="5">**Number of Surveys by Date and Batch**</font> -->
<!-- ```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE} -->
<!-- library(ggplot2) -->
<!-- library(dplyr) -->
<!-- library(hrbrthemes) -->
<!-- library(plotly) -->

<!-- require(haven) -->
<!-- batch_survey <- read_dta("/Users/zhang/Documents/GitHub/covid/data/surveys_by_date_batch.dta") -->

<!-- #prep -->
<!-- batch_survey$survey_date <- as.Date(batch_survey$survey_date, format="%m-%d-%Y") -->
<!-- batch_survey$batch <- factor(batch_survey$batch, levels=c('1','2','3','4','5'), -->
<!--   labels=c("Batch 1","Batch 2","Batch 3","Batch 4","Batch 5")) -->

<!-- median_w <-c(3.429, 6.571, 9.571, 13.143, 16.714) -->
<!-- median_d <-as.Date(c(2020-04-27,2020-05-19,2020-06-09,2020-07-04,2020-07-29),format="%m-%d-%Y",origin = as.Date('2020-04-17')) -->
<!-- labs <- c("April 27","May 19","June 09","July 04","July 29") -->
<!-- median_date <- data.frame(batch = c(1:5), date = median_d, labs, t_height = rep(1,5), ymin = rep(0,5)) -->

<!-- breaks1st<-seq.Date(as.Date("2020-04-17"), as.Date("2020-08-21"), by=14) -->

<!-- # graphing -->
<!-- p <- ggplot() + -->
<!--     geom_col(batch_survey, mapping=aes(x = survey_date, y = counter, fill = batch), color="#e9ecef", alpha=0.5, position = position_stack(reverse = TRUE)) + -->
<!--     scale_fill_manual(values=c("#69b3a2","#404080","#e78ac3","#1f78b4","#fc8d62"), name = "") + -->
<!--     labs(title ="", x = "Date", y = "Number of Surveys per day", fill = "")+ -->
<!--     scale_x_date(date_labels = "%b %d", breaks=breaks1st)+ -->
<!--     theme(title = element_text(size = 16, hjust = 0.5), axis.title = element_text(size = 16, hjust = 0.5),text = element_text(size = 16),  axis.text.x = element_text(size = 16, angle=60, hjust=1), legend.position = "top")  -->

<!-- ply_p <- ggplotly(p) -->
<!-- ply_p[['x']][['layout']][['font']][['size']] <- 12 -->
<!-- ply_p[['x']][['layout']][['xaxis']][['tickfont']][['size']] <- 14 -->
<!-- ply_p[['x']][['layout']][['yaxis']][['tickfont']][['size']] <- 14 -->

<!-- ``` -->

<!-- ####  {.tabset .tabset-pills} -->

<!-- ##### Full sample -->

<!-- ```{r by_batch, eval=FALSE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, include=FALSE} -->
<!-- ply_p -->
<!-- ``` -->

<!-- ##### Female/Male -->

<!-- ##### Urban/Rural   -->


<!-- ```{r counter agg, eval=FALSE, include=FALSE} -->
<!-- # by batch -->
<!-- as.factor(batch_survey$batch) -->
<!-- number_sum <- batch_survey %>%  -->
<!--   group_by(batch) %>%  -->
<!--   summarize(sum(counter)) -->
<!-- table(number_sum) -->

<!-- # by bi-week -->
<!-- agg_counter <- function(date_list){ -->
<!--   w20 <- batch_survey[as.Date(date_list) <= as.Date(batch_survey$survey_date)& as.Date(batch_survey$survey_date) < as.Date(date_list)+14,] %>%  -->
<!--   summarize(sum(counter)) -->
<!-- } -->
<!-- date_list <- c("2020-04-17","2020-05-01","2020-05-15","2020-05-29","2020-06-12","2020-06-26","2020-07-10","2020-07-24","2020-08-07","2020-08-21","2020-09-04") -->
<!-- wn2 <-lapply(date_list,agg_counter) -->
<!-- wn2 <- unlist(wn2) -->

<!-- ``` -->

####

## {}

<!-- These data comes from phone survey interviews conducted by Kenya Life Panel Survey (KLPS) in Kenya. We are collecting data for a sample of ~8000 households in the county, which is representative of the whole ???. At the same time, our weekly sampling method assures weekly representativeness of the overall sample.
weighted to ensure representativeness of the overall KLPS-4 sample-->

The KLPS COVID-19 phone survey sample is split into 5 representative batches, with approximately 1,500 individuals per batch. Each batch will take 2-3 weeks to complete, using sampling method to ensure representativeness of the overall KLPS sample.


So far we have interviewed 6366 households, with the following distribution per batch:


| Batch	| Median Dates	| Number of surveys | 
|-------|:-------------:|:-----------------:|
| 1 |	27 April 2020 	  |  1221             |
| 2 |	19 May 2020 	    |  1301             |
| 3 |	09 June 2020    	|  1302             |
| 4 |	04 July 2020    	|  1317             |
| 5 |	29 July 2020	    |  1225             |



<!-- Also we have the following distribution per two weeks: -->


<!-- | Week	  | Dates                        	| Number of surveys | -->
<!-- |---------|:------------------------------:|:---------:| -->
<!-- | Week 2  |	17 April 2020 -	01 May 2020	| 916 | -->
<!-- | Week 4  |	02 May 2020 - 15 May 2020	  | 732  | -->
<!-- | Week 6  |	16 May 2020 - 29 May 2020 	| 788  | -->
<!-- | Week 8  |	30 May 2020 - 12 June 2020	| 1142  | -->
<!-- | Week 10 |	13 June 2020 - 26 June 2020 |  320| -->
<!-- | Week 12 |	27 June 2020 - 10 July 2020 | 1018 | -->
<!-- | Week 14 |	11 July 2020 - 24 July 2020 | 366    | -->
<!-- | Week 16 |	25 July 2020 - 07 August 2020   | 926   | -->
<!-- | Week 18 |	08 August 2020 - 21 August 2020	| 152    | -->
<!-- | Week 20 |	22 August 2020 -  	            | 6     | -->


